<!DOCTYPE HTML>
<html lang="en">

<head>


<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta property="og:image" content="https://www.dash.org/assets/img/graphics/dash_circle_normal.png" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Developer Examples - Bitcoin</title>

<link rel="stylesheet" href="/css/font-awesome-4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/main.css">
<!--[if lt IE 8]><link rel="stylesheet" href="/css/ie.css"><script type="text/javascript" src="/js/ie.js"></script><![endif]-->
<!--[if IE 8]><link rel="stylesheet" href="/css/ie8.css"><![endif]-->


<script type="text/javascript" src="/js/base.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

  <script src="/js/jquery/jquery-1.11.2.min.js"></script>
  <script src="/js/jquery/jquery.qrcode.min.js"></script>

<link rel="shortcut icon" href="/favicon.png">
<link rel="apple-touch-icon-precomposed" href="/img/icons/logo_ios.png"/>
<script>
    window.cookieconsent_options = {
        theme: 'light-floating'
    }
</script>
<script type="text/javascript" src="/js/cookieconsent/cookieconsent.js"></script>
<script>
if( navigator.doNotTrack != "yes" && navigator.doNotTrack != "1" && window.doNotTrack != "1" && navigator.msDoNotTrack != "1" ){
	var script = document.createElement('script');
	script.src = '/js/analytics.js'
	document.getElementsByTagName("head")[0].appendChild(script);
}
</script>

</head>

<body>

  






<div id="detectmobile" class="detectmobile"></div>







<div class="head"><div>
  
<ul class="lang">
  <li><a>English</a>
  <ul>
    <li><ul>
      
      
        
          <li><a href="/id/">Bahasa Indonesia</a></li>
        
        
          <li><a href="/da/">Dansk</a></li>
        
        
          <li><a href="/de/">Deutsch</a></li>
        
        
          <li><a href="/en/" class="active">English</a></li>
        
        
          <li><a href="/es/">Español</a></li>
        
        
          <li><a href="/fr/">Français</a></li>
        
        
          <li><a href="/it/">Italiano</a></li>
        
        
          <li><a href="/hu/">Magyar</a></li>
        
        
          <li><a href="/nl/">Nederlands</a></li>
        
        
          <li><a href="/pl/">Polski</a></li>
        
        
          <li><a href="/pt_BR/">Português Brasil</a></li>
        
        
          <li><a href="/ro/">Română</a></li>
        
        
          <li><a href="/sl/">Slovenščina</a></li>
        
        
          <li><a href="/sv/">Svenska</a></li>
        
        </ul></li><li><ul>
          <li><a href="/tr/">Türkçe</a></li>
        
        
          <li><a href="/el/">Ελληνικά</a></li>
        
        
          <li><a href="/bg/">български</a></li>
        
        
          <li><a href="/ru/">Русский</a></li>
        
        
          <li><a href="/uk/">Українська</a></li>
        
        
          <li><a href="/ar/">العربية</a></li>
        
        
          <li><a href="/fa/">فارسی</a></li>
        
        
          <li><a href="/hi/">हिन्दी</a></li>
        
        
          <li><a href="/ko/">한국의</a></li>
        
        
          <li><a href="/ja/">日本語</a></li>
        
        
          <li><a href="/zh_CN/">简体中文</a></li>
        
        
          <li><a href="/zh_TW/">繁體中文</a></li>
        
      </ul></li>
    </ul>
  </li>
</ul>

  

<a id="menumobile" class="menumobile" onclick="mobileMenuShow(event);" ontouchstart="mobileMenuShow(event);"></a>

  

<a class="logo" href="/en/"><img src="/img/icons/logotop.svg" alt="Dash"></a>

  
<div id="langselect" class="langselect"><select onchange="window.location=this.value;">
    
          <option value="/id/">Bahasa Indonesia</option>
    
          <option value="/da/">Dansk</option>
    
          <option value="/de/">Deutsch</option>
    
          <option value="/en/" selected="selected">English</option>
    
          <option value="/es/">Español</option>
    
          <option value="/fr/">Français</option>
    
          <option value="/it/">Italiano</option>
    
          <option value="/hu/">Magyar</option>
    
          <option value="/nl/">Nederlands</option>
    
          <option value="/pl/">Polski</option>
    
          <option value="/pt_BR/">Português Brasil</option>
    
          <option value="/ro/">Română</option>
    
          <option value="/sl/">Slovenščina</option>
    
          <option value="/sv/">Svenska</option>
    
          <option value="/tr/">Türkçe</option>
    
          <option value="/el/">Ελληνικά</option>
    
          <option value="/bg/">български</option>
    
          <option value="/ru/">Русский</option>
    
          <option value="/uk/">Українська</option>
    
          <option value="/ar/">العربية</option>
    
          <option value="/fa/">فارسی</option>
    
          <option value="/hi/">हिन्दी</option>
    
          <option value="/ko/">한국의</option>
    
          <option value="/ja/">日本語</option>
    
          <option value="/zh_CN/">简体中文</option>
    
          <option value="/zh_TW/">繁體中文</option>
    
</select></div>

  

<ul id="menusimple" class="menusimple menumain" onclick="mobileMenuHover(event);" ontouchstart="mobileMenuHover(event);">
  <li><a>Introduction</a>
    <ul>
      <li><a href="/en/bitcoin-for-individuals">Individuals</a></li>
      <li><a href="/en/bitcoin-for-businesses">Businesses</a></li>
      <li><a href="/en/bitcoin-for-developers">Developers</a></li>
      <li><a href="/en/getting-started">Getting started</a></li>
      <li><a href="/en/how-it-works">How it works</a></li>
      <li><a href="/en/you-need-to-know">You need to know</a></li>
    </ul>
  </li>
  <li><a>Resources</a>
    <ul>
      <li><a href="/en/resources">Resources</a>
      <li><a href="/en/exchanges">Exchanges</a></li>
      <li><a href="/en/community">Community</a></li>
      <li><a href="/en/developer-documentation">Documentation</a></li>
      <li><a href="/en/vocabulary">Vocabulary</a></li>
      <li><a href="/en/events">Events</a></li>
      
        <li><a href="/en/bitcoin-core/">Bitcoin Core</a></li>
      
    </ul>
  </li>
  <li><a href="/en/innovation">Innovation</a></li>
  <li><a>Participate</a>
    <ul>
      <li><a href="/en/support-bitcoin">Support Bitcoin</a>
      <li><a href="/en/buy">Buy Bitcoin</a></li>
      <li><a href="/en/full-node">Running a full node</a></li>
      <li><a href="/en/development">Development</a></li>
    </ul>
  </li>
  <li><a href="/en/faq">FAQ</a></li>
</ul>

</div></div>

<div class="body">
  

<div class="breadcrumbs">
  
    
      <a href="/en/developer-documentation">Dev Docs</a>
        
      &gt;
    
  
    
      Examples
      
    
  
</div>

  

<div id="content" class="content">
  <link rel="stylesheet" href="/css/jquery-ui.min.css" />

<h1 id="bitcoin-developer-examples">Bitcoin Developer Examples</h1>

<p class="summary">Find examples of how to build programs using Bitcoin.</p>

<div id="toc" class="toc">
  <div>

<ul id="markdown-toc">
  <li><a href="#testing-applications" id="markdown-toc-testing-applications">Testing Applications</a>    <ul>
      <li><a href="#testnet" id="markdown-toc-testnet">Testnet</a></li>
      <li><a href="#regtest-mode" id="markdown-toc-regtest-mode">Regtest Mode</a></li>
    </ul>
  </li>
  <li><a href="#transactions" id="markdown-toc-transactions">Transactions</a>    <ul>
      <li><a href="#transaction-tutorial" id="markdown-toc-transaction-tutorial">Transaction Tutorial</a>        <ul>
          <li><a href="#simple-spending" id="markdown-toc-simple-spending">Simple Spending</a></li>
          <li><a href="#simple-raw-transaction" id="markdown-toc-simple-raw-transaction">Simple Raw Transaction</a></li>
          <li><a href="#complex-raw-transaction" id="markdown-toc-complex-raw-transaction">Complex Raw Transaction</a></li>
          <li><a href="#offline-signing" id="markdown-toc-offline-signing">Offline Signing</a></li>
          <li><a href="#p2sh-multisig" id="markdown-toc-p2sh-multisig">P2SH Multisig</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#payment-processing" id="markdown-toc-payment-processing">Payment Processing</a>    <ul>
      <li><a href="#payment-protocol" id="markdown-toc-payment-protocol">Payment Protocol</a>        <ul>
          <li><a href="#paymentrequest--paymentdetails" id="markdown-toc-paymentrequest--paymentdetails">PaymentRequest &amp; PaymentDetails</a>            <ul>
              <li><a href="#initialization-code" id="markdown-toc-initialization-code">Initialization Code</a></li>
              <li><a href="#configuration-code" id="markdown-toc-configuration-code">Configuration Code</a></li>
              <li><a href="#code-variables" id="markdown-toc-code-variables">Code Variables</a></li>
              <li><a href="#derivable-data" id="markdown-toc-derivable-data">Derivable Data</a></li>
              <li><a href="#output-code" id="markdown-toc-output-code">Output Code</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#p2p-network" id="markdown-toc-p2p-network">P2P Network</a>    <ul>
      <li><a href="#creating-a-bloom-filter" id="markdown-toc-creating-a-bloom-filter">Creating A Bloom Filter</a></li>
      <li><a href="#evaluating-a-bloom-filter" id="markdown-toc-evaluating-a-bloom-filter">Evaluating A Bloom Filter</a></li>
      <li><a href="#retrieving-a-merkleblock" id="markdown-toc-retrieving-a-merkleblock">Retrieving A MerkleBlock</a></li>
      <li><a href="#parsing-a-merkleblock" id="markdown-toc-parsing-a-merkleblock">Parsing A MerkleBlock</a></li>
    </ul>
  </li>
</ul>

    <ul class="goback"><li><a href="/en/developer-documentation">Return To Overview</a></li></ul>
    <ul class="reportissue"><li><a href="https://github.com/bitcoin-dot-org/bitcoin.org/issues/new" onmouseover="updateIssue(event);">Report An Issue</a></li></ul>
    <ul class="editsource"><li><a href="https://github.com/bitcoin-dot-org/bitcoin.org/tree/master/_includes" onmouseover="updateSource(event);">Edit On GitHub</a></li></ul>

  </div>
</div>
<div class="toccontent">

  <!--Temporary disclaimer BEGIN-->
  <div id="develdocdisclaimer" class="develdocdisclaimer"><div>
<b>BETA</b>: This documentation has not been extensively reviewed by Dash experts and so likely contains numerous errors. Please use the <em>Issue</em> and <em>Edit</em> links on the bottom left menu to help us improve.  <a href="#" onclick="disclaimerClose(event);">Click here</a> to close this disclaimer.
<a class="develdocdisclaimerclose" onclick="disclaimerClose(event);">X</a>
</div></div>
  <script>disclaimerAutoClose();</script>

  <!--Temporary disclaimer END-->

  <p><input id="glossary_term" class="glossary_term" placeholder="Search the glossary, RPCs, and more" /></p>

  <p>The following guide aims to provide examples to help you start
building Bitcoin-based applications. To make the best use of this document,
you may want to install the current version of Bitcoin Core, either from
<a href="https://github.com/dashpay/dash/">source</a> or from a <a href="https://www.dash.org/wallets/#wallets">pre-compiled executable</a>.</p>

  <p>Once installed, you’ll have access to three programs: <code class="highlighter-rouge">bitcoind</code>,
<code class="highlighter-rouge">bitcoin-qt</code>, and <code class="highlighter-rouge">bitcoin-cli</code>.</p>

  <ul>
    <li>
      <p><code class="highlighter-rouge">bitcoin-qt</code> provides a combination full Bitcoin peer and wallet
frontend. From the Help menu, you can access a console where you can
enter the RPC commands used throughout this document.</p>
    </li>
    <li>
      <p><code class="highlighter-rouge">bitcoind</code> is more useful for programming: it provides a full peer
which you can interact with through RPCs to port 8332 (or 18332
for testnet).</p>
    </li>
    <li>
      <p><code class="highlighter-rouge">bitcoin-cli</code> allows you to send RPC commands to <code class="highlighter-rouge">bitcoind</code> from the
command line.  For example, <code class="highlighter-rouge">bitcoin-cli help</code></p>
    </li>
  </ul>

  <p>All three programs get settings from <code class="highlighter-rouge">bitcoin.conf</code> in the <code class="highlighter-rouge">Bitcoin</code>
application directory:</p>

  <ul>
    <li>
      <p>Windows: <code class="highlighter-rouge">%APPDATA%\Bitcoin\</code></p>
    </li>
    <li>
      <p>OSX: <code class="highlighter-rouge">$HOME/Library/Application Support/Bitcoin/</code></p>
    </li>
    <li>
      <p>Linux: <code class="highlighter-rouge">$HOME/.bitcoin/</code></p>
    </li>
  </ul>

  <p>To use <code class="highlighter-rouge">bitcoind</code> and <code class="highlighter-rouge">bitcoin-cli</code>, you will need to add a RPC password
to your <code class="highlighter-rouge">bitcoin.conf</code> file. Both programs will read from the same file
if both run on the same system as the same user, so any long random
password will work:</p>

  <div class="highlighter-rouge"><pre><code>rpcpassword=change_this_to_a_long_random_password
</code></pre>
  </div>

  <p>You should also make the <code class="highlighter-rouge">bitcoin.conf</code> file only readable to its
owner.  On Linux, Mac OSX, and other Unix-like systems, this can be
accomplished by running the following command in the Bitcoin application
directory:</p>

  <div class="highlighter-rouge"><pre><code>chmod 0600 bitcoin.conf
</code></pre>
  </div>

  <p>For development, it’s safer and cheaper to use Bitcoin’s test network (testnet)
or regression test mode (regtest) described below.</p>

  <p>Questions about Bitcoin use are best sent to the <a href="https://bitcointalk.org/index.php?board=4.0">BitcoinTalk forum</a> and <a href="https://en.bitcoin.it/wiki/IRC_channels">IRC channels</a>. Errors or suggestions related to
documentation on Bitcoin.org can be <a href="https://github.com/thephez/dash.org/issues">submitted as an issue</a>
or posted to the [bitcoin-documentation mailing list][].</p>

  <p>In the following documentation, some strings have been shortened or wrapped: “[…]”
indicates extra data was removed, and lines ending in a single backslash “\”
are continued below. If you hover your mouse over a paragraph, cross-reference
links will be shown in blue.  If you hover over a cross-reference link, a brief
definition of the term will be displayed in a tooltip.</p>

  <h2 id="testing-applications">Testing Applications</h2>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_testing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_testing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_testing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_testing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>Bitcoin Core provides testing tools designed to let developers
test their applications with reduced risks and limitations.</p>

  <h3 id="testnet">Testnet</h3>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_testing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_testing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_testing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_testing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>When run with no arguments, all Bitcoin Core programs default to Bitcoin’s main
network (<a href="/en/glossary/mainnet" title="The original and main network for Bitcoin transactions, where satoshis have real economic value." id="term-mainnet" class="term">mainnet</a>). However, for development,
it’s safer and cheaper to use Bitcoin’s test network (testnet)
where the satoshis spent have no real-world value. Testnet also relaxes some
restrictions (such as standard transaction checks) so you can test functions
which might currently be disabled by default on mainnet.</p>

  <p>To use testnet, use the argument <code class="highlighter-rouge">-testnet</code><!--noref--> with <code class="highlighter-rouge">bitcoin-cli</code>, <code class="highlighter-rouge">bitcoind</code> or <code class="highlighter-rouge">bitcoin-qt</code> or add
<code class="highlighter-rouge">testnet=1</code><!--noref--> to your <code class="highlighter-rouge">bitcoin.conf</code> file as <a href="/en/developer-examples">described earlier</a>.  To get
free satoshis for testing, use <a href="https://tpfaucet.appspot.com/">Piotr Piasecki’s testnet faucet</a>.
Testnet is a public resource provided for free by members of the
community, so please don’t abuse it.</p>

  <h3 id="regtest-mode">Regtest Mode</h3>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_testing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_testing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_testing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_testing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>For situations
where interaction with random peers and blocks is unnecessary or
unwanted, Bitcoin Core’s regression test mode (regtest mode) lets you
instantly create a brand-new private block chain with the same basic
rules as testnet—but one major difference: you choose when to create
new blocks, so you have complete control over the environment.</p>

  <p>Many developers consider regtest mode the preferred way to develop new
applications. The following example will let you create a regtest
environment after you first <a href="/en/developer-examples">configure bitcoind</a>.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoind -regtest -daemon
Bitcoin server starting</code></pre></figure>

  <p>Start <code class="highlighter-rouge">bitcoind</code> in regtest mode to create a private block chain.</p>

  <div class="highlighter-rouge"><pre><code>## Bitcoin Core 0.10.1 and earlier
bitcoin-cli -regtest setgenerate true 101

## Bitcoin Core master (as of commit 48265f3)
bitcoin-cli -regtest generate 101
</code></pre>
  </div>

  <p>Generate 101 blocks using a special RPC
which is only available in regtest mode. This takes less than a second on
a generic PC. Because this is a new block chain using Bitcoin’s default
rules, the first blocks pay a block reward of 50 bitcoins.  Unlike
mainnet, in regtest mode only the first 150 blocks pay a reward of 50 bitcoins.
However, a block must have 100 confirmations before that reward can be
spent, so we generate 101 blocks to get access to the coinbase
transaction from block #1.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash">bitcoin-cli -regtest getbalance
50.00000000</code></pre></figure>

  <p>Verify that we now have 50 bitcoins available to spend.</p>

  <p>You can now use Bitcoin Core RPCs prefixed with <code class="highlighter-rouge">bitcoin-cli -regtest</code><!--noref-->.</p>

  <p>Regtest wallets and block chain state (chainstate) are saved in the <code class="highlighter-rouge">regtest</code><!--noref-->
subdirectory of the Bitcoin Core configuration directory. You can safely
delete the <code class="highlighter-rouge">regtest</code><!--noref--> subdirectory and restart Bitcoin Core to
start a new regtest. (See the <a href="/en/developer-examples">Developer Examples Introduction</a> for default
configuration directory locations on various operating systems. Always back up
mainnet wallets before performing dangerous operations such as deleting.)</p>

  <h2 id="transactions">Transactions</h2>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_transactions.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_transactions.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_transactions.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_transactions.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <h3 id="transaction-tutorial">Transaction Tutorial</h3>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_transactions.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_transactions.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_transactions.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_transactions.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>Creating transactions is something most Bitcoin applications do.
This section describes how to use Bitcoin Core’s RPC interface to
create transactions with various attributes.</p>

  <p>Your applications may use something besides Bitcoin Core to create
transactions, but in any system, you will need to provide the same kinds
of data to create transactions with the same attributes as those
described below.</p>

  <p>In order to use this tutorial, you will need to setup <a href="https://www.dash.org/wallets/#wallets">Bitcoin Core</a>
and create a regression test mode environment with 50 BTC in your test
wallet.</p>

  <h4 id="simple-spending">Simple Spending</h4>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_transactions.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_transactions.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_transactions.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_transactions.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>Bitcoin Core provides several RPCs which handle all the details of
spending, including creating change outputs and paying appropriate fees.
Even advanced users should use these RPCs whenever possible to decrease
the chance that satoshis will be lost by mistake.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest getnewaddress
mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou

<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS</span><span class="o">=</span>mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou</code></pre></figure>

  <p>Get a new Bitcoin address and save it in the shell variable <code class="highlighter-rouge">$NEW_ADDRESS</code>.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest sendtoaddress <span class="nv">$NEW_ADDRESS</span> 10.00
263c018582731ff54dc72c7d67e858c002ae298835501d80200f05753de0edf0</code></pre></figure>

  <p>Send 10 bitcoins to the address using the <code class="highlighter-rouge">sendtoaddress</code> RPC.  The
returned hex string is the transaction identifier (txid).</p>

  <p>The <code class="highlighter-rouge">sendtoaddress</code> RPC automatically selects an unspent transaction
output (UTXO) from which to spend the satoshis. In this case, it
withdrew the satoshis from our only available UTXO, the coinbase
transaction for block #1 which matured with the creation of block #101.
To spend a specific UTXO, you could use the <code class="highlighter-rouge">sendfrom</code> RPC instead.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest listunspent
<span class="o">[</span>
<span class="o">]</span></code></pre></figure>

  <p>Use the <code class="highlighter-rouge">listunspent</code> RPC to display the UTXOs belonging to this wallet.
The list is empty because it defaults to only showing confirmed
UTXOs and we just spent our only confirmed UTXO.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest listunspent 0</code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"muhtvdmsnbQEPFuEmxcChX58fGvXaaUoVt"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a9149ba386253ea698158b6d34802bb9b550\
                          f5ce36dd88ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">40.00000000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"account"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a914a57414e5ffae9ef5074bacbe10a320bb\
                          2614e1f388ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">10.00000000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre></figure>

  </div>

  <p>Re-running the <code class="highlighter-rouge">listunspent</code> RPC with the argument “0” to also display
unconfirmed transactions shows that we have two UTXOs, both with the
same txid. The first UTXO shown is a change output that <code class="highlighter-rouge">sendtoaddress</code>
created using a new address from the key pool. The second UTXO shown is
the spend to the address we provided. If we had spent those satoshis to
someone else, that second transaction would not be displayed in our
list of UTXOs.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest generate 1

<span class="gp">&gt; </span><span class="nb">unset </span>NEW_ADDRESS</code></pre></figure>

  <p>Create a new block to confirm the transaction above (takes less than a
second) and clear the shell variable.</p>

  <h4 id="simple-raw-transaction">Simple Raw Transaction</h4>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_transactions.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_transactions.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_transactions.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_transactions.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>The raw transaction RPCs allow users to create custom transactions and
delay broadcasting those transactions. However, mistakes made in raw
transactions may not be detected by Bitcoin Core, and a number of raw
transaction users have permanently lost large numbers of satoshis, so
please be careful using raw transactions on mainnet.</p>

  <p>This subsection covers one of the simplest possible raw transactions.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest listunspent</code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"muhtvdmsnbQEPFuEmxcChX58fGvXaaUoVt"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a9149ba386253ea698158b6d34802bb9b550\
                          f5ce36dd88ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">40.00000000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"account"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a914a57414e5ffae9ef5074bacbe10a320bb\
                          2614e1f388ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">10.00000000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3f4fa19803dec4d6a84fae3821da7ac7577080ef754512\
                  94e71f9b20e0ab1e7b"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mwJTL1dZG8BAP6X7Be3CNNcuVKi7Qqt7Gk"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"210260a275cccf0f4b106220725be516adba27\
                          52db1bec8c5b7174c89c4c07891f88ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">50.00000000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">UTXO_TXID</span><span class="o">=</span>3f4fa19803dec4d6a84fae3821da7ac7577080ef75451294e71f[...]
<span class="gp">&gt; </span><span class="nv">UTXO_VOUT</span><span class="o">=</span>0</code></pre></figure>

  </div>

  <p>Re-rerun <code class="highlighter-rouge">listunspent</code>. We now have three UTXOs: the two transactions we
created before plus the coinbase transaction from block #2. We save the
txid and output index number (vout) of that coinbase UTXO to shell
variables.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash">&gt; bitcoin-cli -regtest getnewaddress
mz6KvC4aoUeo6wSxtiVQTo7FDwPnkp6URG

<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS</span><span class="o">=</span>mz6KvC4aoUeo6wSxtiVQTo7FDwPnkp6URG</code></pre></figure>

  <p>Get a new address to use in the raw transaction.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">## Outputs - inputs = transaction fee, so always double-check your math!</span>
<span class="gp">&gt; </span>bitcoin-cli -regtest createrawtransaction <span class="s1">'''
    [
      {
        "txid": "'</span><span class="nv">$UTXO_TXID</span><span class="s1">'",
        "vout": '</span><span class="nv">$UTXO_VOUT</span><span class="s1">'
      }
    ]
    '''</span> <span class="s1">'''
    {
      "'</span><span class="nv">$NEW_ADDRESS</span><span class="s1">'": 49.9999
    }'''</span>
01000000017b1eabe0209b1fe794124575ef807057c77ada2138ae4fa8d6c4de<span class="se">\</span>
0398a14f3f0000000000ffffffff01f0ca052a010000001976a914cbc20a7664<span class="se">\</span>
f2f69e5355aa427045bc15e7c6c77288ac00000000

<span class="gp">&gt; </span><span class="nv">RAW_TX</span><span class="o">=</span>01000000017b1eabe0209b1fe794124575ef807057c77ada2138ae4[...]</code></pre></figure>

  <p>Using two arguments to the <code class="highlighter-rouge">createrawtransaction</code> RPC, we create a new
raw format transaction. The first argument (a JSON array) references
the txid of the coinbase transaction from block #2 and the index
number (0) of the output from that transaction we want to spend. The
second argument (a JSON object) creates the output with the address
(public key hash) and number of bitcoins we want to transfer.
We save the resulting raw format transaction to a shell variable.</p>

  <p><img src="/img/icons/icon_warning.svg" alt="Warning icon" />
 <strong>Warning:</strong> <code class="highlighter-rouge">createrawtransaction</code> does not automatically create change
outputs, so you can easily accidentally pay a large transaction fee. In
this example, our input had 50.0000 bitcoins and our output
(<code class="highlighter-rouge">$NEW_ADDRESS</code>) is being paid 49.9999 bitcoins, so the transaction will
include a fee of 0.0001 bitcoins. If we had paid <code class="highlighter-rouge">$NEW_ADDRESS</code> only 10
bitcoins with no other changes to this transaction, the transaction fee
would be a whopping 40 bitcoins. See the Complex Raw Transaction
subsection below for how to create a transaction with multiple outputs so you
can send the change back to yourself.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest decoderawtransaction <span class="nv">$RAW_TX</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"c80b343d2ce2b5d829c2de9854c7c8d423c0e33bda264c4013\
              8d834aab4c0638"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hash"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"c80b343d2ce2b5d829c2de9854c7c8d423c0e33bda264c40138d834aab4c0638"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"size"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vsize"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span><span class="w">		
    </span><span class="nt">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"locktime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vin"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3f4fa19803dec4d6a84fae3821da7ac7577080ef75\
                      451294e71f9b20e0ab1e7b"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"scriptSig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"asm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"sequence"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4294967295</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">49.99990000</span><span class="p">,</span><span class="w">
            </span><span class="nt">"n"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"asm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"OP_DUP OP_HASH160 cbc20a7664f2f69e5355a\
                         a427045bc15e7c6c772 OP_EQUALVERIFY OP_CHECKSIG"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a914cbc20a7664f2f69e5355aa427045bc15e\
                         7c6c77288ac"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"reqSigs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pubkeyhash"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"addresses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"mz6KvC4aoUeo6wSxtiVQTo7FDwPnkp6URG"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

  </div>

  <p>Use the <code class="highlighter-rouge">decoderawtransaction</code> RPC to see exactly what the transaction
we just created does.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest signrawtransaction <span class="nv">$RAW_TX</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"01000000017b1eabe0209b1fe794124575ef807057c77ada213\
             8ae4fa8d6c4de0398a14f3f00000000494830450221008949f0\
             cb400094ad2b5eb399d59d01c14d73d8fe6e96df1a7150deb38\
             8ab8935022079656090d7f6bac4c9a94e0aad311a4268e082a7\
             25f8aeae0573fb12ff866a5f01ffffffff01f0ca052a0100000\
             01976a914cbc20a7664f2f69e5355aa427045bc15e7c6c77288\
             ac00000000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"complete"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">SIGNED_RAW_TX</span><span class="o">=</span>01000000017b1eabe0209b1fe794124575ef807057c77ada[...]</code></pre></figure>

  </div>

  <p>Use the <code class="highlighter-rouge">signrawtransaction</code> RPC to sign the transaction created by
<code class="highlighter-rouge">createrawtransaction</code> and save the returned “hex” raw format signed
transaction to a shell variable.</p>

  <p>Even though the transaction is now complete, the Bitcoin Core node we’re
connected to doesn’t know anything about the transaction, nor does any
other part of the network. We’ve created a spend, but we haven’t
actually spent anything because we could simply unset the
<code class="highlighter-rouge">$SIGNED_RAW_TX</code> variable to eliminate the transaction.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest sendrawtransaction <span class="nv">$SIGNED_RAW_TX</span>
c7736a0a0046d5a8cc61c8c3c2821d4d7517f5de2bc66a966011aaa79965ffba</code></pre></figure>

  <p>Send the signed transaction to the connected node using the
<code class="highlighter-rouge">sendrawtransaction</code> RPC. After accepting the transaction, the node
would usually then broadcast it to other peers, but we’re not currently
connected to other peers because we started in regtest mode.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest generate 1

<span class="gp">&gt; </span><span class="nb">unset </span>UTXO_TXID UTXO_VOUT NEW_ADDRESS RAW_TX SIGNED_RAW_TX</code></pre></figure>

  <p>Generate a block to confirm the transaction and clear our shell
variables.</p>

  <h4 id="complex-raw-transaction">Complex Raw Transaction</h4>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_transactions.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_transactions.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_transactions.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_transactions.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>In this example, we’ll create a transaction with two inputs and two
outputs.  We’ll sign each of the inputs separately, as might happen if
the two inputs belonged to different people who agreed to create a
transaction together (such as a CoinJoin transaction).</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest listunspent</code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"muhtvdmsnbQEPFuEmxcChX58fGvXaaUoVt"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a9149ba386253ea698158b6d34802bb9b550\
                          f5ce36dd88ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">40.00000000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"263c018582731ff54dc72c7d67e858c002ae298835501d\
                  80200f05753de0edf0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mvbnrCX3bg1cDRUu8pkecrvP6vQkSLDSou"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"account"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a914a57414e5ffae9ef5074bacbe10a320bb\
                          2614e1f388ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">10.00000000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"78203a8f6b529693759e1917a1b9f05670d036fbb12911\
                  0ed26be6a36de827f3"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"n2KprMQm4z2vmZnPMENfbp2P1LLdAEFRjS"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"210229688a74abd0d5ad3b06ddff36fa9cd8ed\
                          d181d97b9489a6adc40431fb56e1d8ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">50.00000000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"c7736a0a0046d5a8cc61c8c3c2821d4d7517f5de2bc66a\
                  966011aaa79965ffba"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mz6KvC4aoUeo6wSxtiVQTo7FDwPnkp6URG"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"account"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a914cbc20a7664f2f69e5355aa427045bc15\
                          e7c6c77288ac"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"amount"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">49.99990000</span><span class="p">,</span><span class="w">
        </span><span class="nt">"confirmations"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"spendable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"solvable"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">UTXO1_TXID</span><span class="o">=</span>78203a8f6b529693759e1917a1b9f05670d036fbb129110ed26[...]
<span class="gp">&gt; </span><span class="nv">UTXO1_VOUT</span><span class="o">=</span>0
<span class="gp">&gt; </span><span class="nv">UTXO1_ADDRESS</span><span class="o">=</span>n2KprMQm4z2vmZnPMENfbp2P1LLdAEFRjS
 
<span class="gp">&gt; </span><span class="nv">UTXO2_TXID</span><span class="o">=</span>263c018582731ff54dc72c7d67e858c002ae298835501d80200[...]
<span class="gp">&gt; </span><span class="nv">UTXO2_VOUT</span><span class="o">=</span>0
<span class="gp">&gt; </span><span class="nv">UTXO2_ADDRESS</span><span class="o">=</span>muhtvdmsnbQEPFuEmxcChX58fGvXaaUoVt</code></pre></figure>

  </div>

  <p>For our two inputs, we select two UTXOs by placing the txid and output
index numbers (vouts) in shell variables.  We also save the addresses
corresponding to the public keys (hashed or unhashed) used in those
transactions. We need the addresses so we can get the corresponding
private keys from our wallet.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest dumpprivkey <span class="nv">$UTXO1_ADDRESS</span>
cSp57iWuu5APuzrPGyGc4PGUeCg23PjenZPBPoUs24HtJawccHPm

<span class="gp">&gt; </span>bitcoin-cli -regtest dumpprivkey <span class="nv">$UTXO2_ADDRESS</span>
cT26DX6Ctco7pxaUptJujRfbMS2PJvdqiSMaGaoSktHyon8kQUSg

<span class="gp">&gt; </span><span class="nv">UTXO1_PRIVATE_KEY</span><span class="o">=</span>cSp57iWuu5APuzrPGyGc4PGUeCg23PjenZPBPoUs24Ht[...]

<span class="gp">&gt; </span><span class="nv">UTXO2_PRIVATE_KEY</span><span class="o">=</span>cT26DX6Ctco7pxaUptJujRfbMS2PJvdqiSMaGaoSktHy[...]</code></pre></figure>

  <p>Use the <code class="highlighter-rouge">dumpprivkey</code> RPC to get the private keys corresponding to the
public keys used in the two UTXOs out inputs we will be spending.  We need
the private keys so we can sign each of the inputs separately.</p>

  <p><img src="/img/icons/icon_warning.svg" alt="Warning icon" />
 <strong>Warning:</strong> Users should never manually manage private keys on mainnet.
As dangerous as raw transactions are (see warnings above), making a
mistake with a private key can be much worse—as in the case of a HD
wallet <a href="/en/developer-guide#hardened-keys">cross-generational key compromise</a>.
These examples are to help you learn, not for you to emulate on
mainnet.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest getnewaddress
n4puhBEeEWD2VvjdRC9kQuX2abKxSCMNqN
<span class="gp">&gt; </span>bitcoin-cli -regtest getnewaddress
n4LWXU59yM5MzQev7Jx7VNeq1BqZ85ZbLj

<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS1</span><span class="o">=</span>n4puhBEeEWD2VvjdRC9kQuX2abKxSCMNqN
<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS2</span><span class="o">=</span>n4LWXU59yM5MzQev7Jx7VNeq1BqZ85ZbLj</code></pre></figure>

  <p>For our two outputs, get two new addresses.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">## Outputs - inputs = transaction fee, so always double-check your math!</span>
<span class="gp">&gt; </span>bitcoin-cli -regtest createrawtransaction <span class="s1">'''
    [
      {
        "txid": "'</span><span class="nv">$UTXO1_TXID</span><span class="s1">'", 
        "vout": '</span><span class="nv">$UTXO1_VOUT</span><span class="s1">'
      }, 
      {
        "txid": "'</span><span class="nv">$UTXO2_TXID</span><span class="s1">'",
        "vout": '</span><span class="nv">$UTXO2_VOUT</span><span class="s1">'
      }
    ]
    '''</span> <span class="s1">'''
    {
      "'</span><span class="nv">$NEW_ADDRESS1</span><span class="s1">'": 79.9999, 
      "'</span><span class="nv">$NEW_ADDRESS2</span><span class="s1">'": 10 
    }'''</span>
0100000002f327e86da3e66bd20e1129b1fb36d07056f0b9a117199e75939652<span class="se">\</span>
6b8f3a20780000000000fffffffff0ede03d75050f20801d50358829ae02c058<span class="se">\</span>
e8677d2cc74df51f738285013c260000000000ffffffff02f028d6dc01000000<span class="se">\</span>
1976a914ffb035781c3c69e076d48b60c3d38592e7ce06a788ac00ca9a3b0000<span class="se">\</span>
00001976a914fa5139067622fd7e1e722a05c17c2bb7d5fd6df088ac00000000

<span class="gp">&gt; </span><span class="nv">RAW_TX</span><span class="o">=</span>0100000002f327e86da3e66bd20e1129b1fb36d07056f0b9a117199[...]</code></pre></figure>

  <p>Create the raw transaction using <code class="highlighter-rouge">createrawtransaction</code> much the same as
before, except now we have two inputs and two outputs.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest signrawtransaction <span class="nv">$RAW_TX</span> <span class="s1">'[]'</span> <span class="s1">'''
    [
      "'</span><span class="nv">$UTXO1_PRIVATE_KEY</span><span class="s1">'"
    ]'''</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0100000002f327e86da3e66bd20e1129b1fb36d07056f0b9a11\
             7199e759396526b8f3a20780000000049483045022100fce442\
             ec52aa2792efc27fd3ad0eaf7fa69f097fdcefab017ea56d179\
             9b10b2102207a6ae3eb61e11ffaba0453f173d1792f1b7bb8e7\
             422ea945101d68535c4b474801fffffffff0ede03d75050f208\
             01d50358829ae02c058e8677d2cc74df51f738285013c260000\
             000000ffffffff02f028d6dc010000001976a914ffb035781c3\
             c69e076d48b60c3d38592e7ce06a788ac00ca9a3b0000000019\
             76a914fa5139067622fd7e1e722a05c17c2bb7d5fd6df088ac0\
             0000000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"complete"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="s2">"errors"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"txid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c53f8f5ac0b6b10cdc77f543718eb3880fee6cf9b5e0cbf4edb2a59c0fae09a4"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"vout"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nt">"scriptSig"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sequence"</span><span class="p">:</span><span class="w"> </span><span class="mi">4294967295</span><span class="p">,</span><span class="w">
      </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Operation not valid with the current stack size"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">PARTLY_SIGNED_RAW_TX</span><span class="o">=</span>0100000002f327e86da3e66bd20e1129b1fb36d07[...]</code></pre></figure>

  </div>

  <p>Signing the raw transaction with <code class="highlighter-rouge">signrawtransaction</code> gets more
complicated as we now have three arguments:</p>

  <ol>
    <li>
      <p>The unsigned raw transaction.</p>
    </li>
    <li>
      <p>An empty array. We don’t do anything with this argument in this
operation, but some valid JSON must be provided to get access to the
later positional arguments.</p>
    </li>
    <li>
      <p>The private key we want to use to sign one of the inputs.</p>
    </li>
  </ol>

  <p>The result is a raw transaction with only one input signed; the fact
that the transaction isn’t fully signed is indicated by value of the
<code class="highlighter-rouge">complete</code> JSON field.  We save the incomplete, partly-signed raw
transaction hex to a shell variable.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest signrawtransaction <span class="nv">$PARTLY_SIGNED_RAW_TX</span> <span class="s1">'[]'</span> <span class="s1">'''
    [
      "'</span><span class="nv">$UTXO2_PRIVATE_KEY</span><span class="s1">'"
    ]'''</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0100000002f327e86da3e66bd20e1129b1fb36d07056f0b9a11\
             7199e759396526b8f3a20780000000049483045022100fce442\
             ec52aa2792efc27fd3ad0eaf7fa69f097fdcefab017ea56d179\
             9b10b2102207a6ae3eb61e11ffaba0453f173d1792f1b7bb8e7\
             422ea945101d68535c4b474801fffffffff0ede03d75050f208\
             01d50358829ae02c058e8677d2cc74df51f738285013c260000\
             00006b483045022100b77f935ff366a6f3c2fdeb83589c79026\
             5d43b3d2cf5e5f0047da56c36de75f40220707ceda75d8dcf2c\
             caebc506f7293c3dcb910554560763d7659fb202f8ec324b012\
             102240d7d3c7aad57b68aa0178f4c56f997d1bfab2ded3c2f94\
             27686017c603a6d6ffffffff02f028d6dc010000001976a914f\
             fb035781c3c69e076d48b60c3d38592e7ce06a788ac00ca9a3b\
             000000001976a914fa5139067622fd7e1e722a05c17c2bb7d5f\
             d6df088ac00000000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"complete"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

  </div>

  <p>To sign the second input, we repeat the process we used to sign the
first input using the second private key. Now that both inputs are
signed, the <code class="highlighter-rouge">complete</code> result is <em>true</em>.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span><span class="nb">unset </span>PARTLY_SIGNED_RAW_TX RAW_TX NEW_ADDRESS1 <span class="o">[</span>...]</code></pre></figure>

  <p>Clean up the shell variables used. Unlike previous subsections, we’re
not going to send this transaction to the connected node with
<code class="highlighter-rouge">sendrawtransaction</code>. This will allow us to illustrate in the Offline
Signing subsection below how to spend a transaction which is not yet in
the block chain or memory pool.</p>

  <h4 id="offline-signing">Offline Signing</h4>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_transactions.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_transactions.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_transactions.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_transactions.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>We will now spend the transaction created in the Complex Raw Transaction
subsection above without sending it to the local node first. This is the
same basic process used by wallet programs for offline
signing—which generally means signing a transaction without access
to the current UTXO set.</p>

  <p>Offline signing is safe. However, in this example we will also be
spending an output which is not part of the block chain because the
transaction containing it has never been broadcast. That can be unsafe:</p>

  <p><img src="/img/icons/icon_warning.svg" alt="Warning icon" />
 <strong>Warning:</strong> Transactions which spend outputs from unconfirmed
transactions are vulnerable to transaction malleability. Be sure to read
about transaction malleability and adopt good practices before spending
unconfirmed transactions on mainnet.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span><span class="nv">OLD_SIGNED_RAW_TX</span><span class="o">=</span>0100000002f327e86da3e66bd20e1129b1fb36d07056<span class="se">\</span>
      f0b9a117199e759396526b8f3a20780000000049483045022100fce442<span class="se">\</span>
      ec52aa2792efc27fd3ad0eaf7fa69f097fdcefab017ea56d1799b10b21<span class="se">\</span>
      02207a6ae3eb61e11ffaba0453f173d1792f1b7bb8e7422ea945101d68<span class="se">\</span>
      535c4b474801fffffffff0ede03d75050f20801d50358829ae02c058e8<span class="se">\</span>
      677d2cc74df51f738285013c26000000006b483045022100b77f935ff3<span class="se">\</span>
      66a6f3c2fdeb83589c790265d43b3d2cf5e5f0047da56c36de75f40220<span class="se">\</span>
      707ceda75d8dcf2ccaebc506f7293c3dcb910554560763d7659fb202f8<span class="se">\</span>
      ec324b012102240d7d3c7aad57b68aa0178f4c56f997d1bfab2ded3c2f<span class="se">\</span>
      9427686017c603a6d6ffffffff02f028d6dc010000001976a914ffb035<span class="se">\</span>
      781c3c69e076d48b60c3d38592e7ce06a788ac00ca9a3b000000001976<span class="se">\</span>
      a914fa5139067622fd7e1e722a05c17c2bb7d5fd6df088ac00000000</code></pre></figure>

  <p>Put the previously signed (but not sent) transaction into a shell
variable.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest decoderawtransaction <span class="nv">$OLD_SIGNED_RAW_TX</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad\
              40cf18ffbb8e09"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hash"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad40cf18ffbb8e09"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"size"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">340</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vsize"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">340</span><span class="p">,</span><span class="w">
    </span><span class="nt">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"locktime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vin"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"78203a8f6b529693759e1917a1b9f05670d036fbb1\
                      29110ed26be6a36de827f3"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"scriptSig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"asm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3045022100fce442ec52aa2792efc27fd3ad0ea\
                         f7fa69f097fdcefab017ea56d1799b10b210220\
                         7a6ae3eb61e11ffaba0453f173d1792f1b7bb8e\
                         7422ea945101d68535c4b474801"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"483045022100FCE442ec52aa2792efc27fd3ad0\
                         eaf7fa69f097fdcefab017ea56d1799b10b2102\
                         207a6ae3eb61e11ffaba0453f173d1792f1b7bb\
                         8e7422ea945101d68535c4b474801"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"sequence"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4294967295</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"263c018582731ff54dc72c7d67e858c002ae298835\
                      501d80200f05753de0edf0"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"scriptSig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"asm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3045022100b77f935ff366a6f3c2fdeb83589c7\
                         90265d43b3d2cf5e5f0047da56c36de75f40220\
                         707ceda75d8dcf2ccaebc506f7293c3dcb91055\
                         4560763d7659fb202f8ec324b01
                         02240d7d3c7aad57b68aa0178f4c56f997d1bfa\
                         b2ded3c2f9427686017c603a6d6"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"483045022100b77f935ff366a6f3c2fdeb83589\
                         c790265d43b3d2cf5e5f0047da56c36de75f402\
                         20707ceda75d8dcf2ccaebc506f7293c3dcb910\
                         554560763d7659fb202f8ec324b012102240d7d\
                         3c7aad57b68aa0178f4c56f997d1bfab2ded3c2\
                         f9427686017c603a6d6"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"sequence"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4294967295</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">79.99990000</span><span class="p">,</span><span class="w">
            </span><span class="nt">"n"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"asm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"OP_DUP OP_HASH160 ffb035781c3c69e076d48\
                         b60c3d38592e7ce06a7 OP_EQUALVERIFY OP_CHECKSIG"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a914ffb035781c3c69e076d48b60c3d38592e\
                         7ce06a788ac"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"reqSigs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pubkeyhash"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"addresses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"n4puhBEeEWD2VvjdRC9kQuX2abKxSCMNqN"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">10.00000000</span><span class="p">,</span><span class="w">
            </span><span class="nt">"n"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"asm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"OP_DUP OP_HASH160 fa5139067622fd7e1e722\
                         a05c17c2bb7d5fd6df0 OP_EQUALVERIFY OP_CHECKSIG"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a914fa5139067622fd7e1e722a05c17c2bb7d\
                         5fd6df088ac"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"reqSigs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pubkeyhash"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"addresses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"n4LWXU59yM5MzQev7Jx7VNeq1BqZ85ZbLj"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">UTXO_TXID</span><span class="o">=</span>682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad40[...]
<span class="gp">&gt; </span><span class="nv">UTXO_VOUT</span><span class="o">=</span>1
<span class="gp">&gt; </span><span class="nv">UTXO_OUTPUT_SCRIPT</span><span class="o">=</span>76a914fa5139067622fd7e1e722a05c17c2bb7d5fd6[...]</code></pre></figure>

  </div>

  <p>Decode the signed raw transaction so we can get its txid. Also, choose a
specific one of its UTXOs to spend and save that UTXO’s output index number
(vout) and hex pubkey script (scriptPubKey) into shell variables.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest getnewaddress
mfdCHEFL2tW9eEUpizk7XLZJcnFM4hrp78

<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS</span><span class="o">=</span>mfdCHEFL2tW9eEUpizk7XLZJcnFM4hrp78</code></pre></figure>

  <p>Get a new address to spend the satoshis to.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">## Outputs - inputs = transaction fee, so always double-check your math!</span>
<span class="gp">&gt; </span>bitcoin-cli -regtest createrawtransaction <span class="s1">'''
    [
      {
        "txid": "'</span><span class="nv">$UTXO_TXID</span><span class="s1">'",
        "vout": '</span><span class="nv">$UTXO_VOUT</span><span class="s1">'
      }
    ]
    '''</span> <span class="s1">'''
    {
      "'</span><span class="nv">$NEW_ADDRESS</span><span class="s1">'": 9.9999
    }'''</span>
0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee96c990c8fdfb99cf6<span class="se">\</span>
1d88ad2c680100000000ffffffff01f0a29a3b000000001976a914012e2ba6a0<span class="se">\</span>
51c033b03d712ca2ea00a35eac1e7988ac00000000

<span class="gp">&gt; </span><span class="nv">RAW_TX</span><span class="o">=</span>0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee96c990c8[...]</code></pre></figure>

  <p>Create the raw transaction the same way we’ve done in the previous
subsections.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash">    &gt; bitcoin-cli -regtest signrawtransaction <span class="nv">$RAW_TX</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee\
                 96c990c8fdfb99cf61d88ad2c680100000000ffffffff01\
                 f0a29a3b000000001976a914012e2ba6a051c033b03d712\
                 ca2ea00a35eac1e7988ac00000000"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"complete"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span></code></pre></figure>

  </div>

  <p>Attempt to sign the raw transaction without any special arguments, the
way we successfully signed the the raw transaction in the Simple Raw
Transaction subsection. If you’ve read the <a href="/en/developer-guide#transactions" title="A transaction spending satoshis">Transaction section</a> of
the guide, you may know why the call fails and leaves the raw
transaction hex unchanged.</p>

  <p><img src="/img/dev/en-signing-output-to-spend.svg" alt="Old Transaction Data Required To Be Signed" /></p>

  <p>As illustrated above, the data that gets signed includes the txid and
vout from the previous transaction.  That information is included in the
<code class="highlighter-rouge">createrawtransaction</code> raw transaction.  But the data that gets signed
also includes the pubkey script from the previous transaction, even
though it doesn’t appear in either the unsigned or signed transaction.</p>

  <p>In the other raw transaction subsections above, the previous output was
part of the UTXO set known to the wallet, so the wallet was able to use
the txid and output index number to find the previous pubkey script and
insert it automatically.</p>

  <p>In this case, you’re spending an output which is unknown to the wallet,
so it can’t automatically insert the previous pubkey script.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest signrawtransaction <span class="nv">$RAW_TX</span> <span class="s1">'''
    [
      {
        "txid": "'</span><span class="nv">$UTXO_TXID</span><span class="s1">'", 
        "vout": '</span><span class="nv">$UTXO_VOUT</span><span class="s1">', 
        "scriptPubKey": "'</span><span class="nv">$UTXO_OUTPUT_SCRIPT</span><span class="s1">'"
      }
    ]'''</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee96c9\
             90c8fdfb99cf61d88ad2c68010000006b483045022100c3f92f\
             b74bfa687d76ebe75a654510bb291b8aab6f89ded4fe26777c2\
             eb233ad02207f779ce2a181cc4055cb0362aba7fd7a6f72d5db\
             b9bd863f4faaf47d8d6c4b500121028e4e62d25760709806131\
             b014e2572f7590e70be01f0ef16bfbd51ea5f389d4dffffffff\
             01f0a29a3b000000001976a914012e2ba6a051c033b03d712ca\
             2ea00a35eac1e7988ac00000000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"complete"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">SIGNED_RAW_TX</span><span class="o">=</span>0100000001098ebbff18cf40ad3ba02ded7d3558d7ca6ee9[...]</code></pre></figure>

  </div>

  <p>Successfully sign the transaction by providing the previous pubkey
script and other required input data.</p>

  <p>This specific operation is typically what offline signing wallets do.
The online wallet creates the raw transaction and gets the previous
pubkey scripts for all the inputs. The user brings this information to
the offline wallet. After displaying the transaction details to the
user, the offline wallet signs the transaction as we did above. The
user takes the signed transaction back to the online wallet, which
broadcasts it.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest sendrawtransaction <span class="nv">$SIGNED_RAW_TX</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">error:</span><span class="w"> </span><span class="p">{</span><span class="nt">"code"</span><span class="p">:</span><span class="mi">-22</span><span class="p">,</span><span class="nt">"message"</span><span class="p">:</span><span class="s2">"TX rejected"</span><span class="p">}</span></code></pre></figure>

  </div>

  <p>Attempt to broadcast the second transaction before we’ve broadcast the
first transaction.  The node rejects this attempt because the second
transaction spends an output which is not a UTXO the node knows about.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest sendrawtransaction <span class="nv">$OLD_SIGNED_RAW_TX</span>
682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad40cf18ffbb8e09
<span class="gp">&gt; </span>bitcoin-cli -regtest sendrawtransaction <span class="nv">$SIGNED_RAW_TX</span>
67d53afa1a8167ca093d30be7fb9dcb8a64a5fdecacec9d93396330c47052c57</code></pre></figure>

  <p>Broadcast the first transaction, which succeeds, and then broadcast the
second transaction—which also now succeeds because the node now sees
the UTXO.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest getrawmempool</code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w">
    </span><span class="s2">"67d53afa1a8167ca093d30be7fb9dcb8a64a5fdecacec9d93396330c47052c57"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"682cad881df69cb9df8f0c996ce96ecad758357ded2da03bad40cf18ffbb8e09"</span><span class="w">
</span><span class="p">]</span></code></pre></figure>

  </div>

  <p>We have once again not generated an additional block, so the transactions
above have not yet become part of the regtest block chain.  However, they
are part of the local node’s memory pool.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span><span class="nb">unset </span>OLD_SIGNED_RAW_TX SIGNED_RAW_TX RAW_TX <span class="o">[</span>...]</code></pre></figure>

  <p>Remove old shell variables.</p>

  <h4 id="p2sh-multisig">P2SH Multisig</h4>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_transactions.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_transactions.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_transactions.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_transactions.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>In this subsection, we will create a P2SH multisig address, spend
satoshis to it, and then spend those satoshis from it to another
address.</p>

  <p>Creating a multisig address is easy. Multisig outputs have two
parameters, the <em>minimum</em> number of signatures required (<em>m</em>) and the
<em>number</em> of public keys to use to validate those signatures. This is
called m-of-n, and in this case we’ll be using 2-of-3.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash">    &gt; bitcoin-cli -regtest getnewaddress
    mhAXF4Eq7iRyvbYk1mpDVBiGdLP3YbY6Dm
    &gt; bitcoin-cli -regtest getnewaddress
    moaCrnRfP5zzyhW8k65f6Rf2z5QpvJzSKe
    &gt; bitcoin-cli -regtest getnewaddress
    mk2QpYatsKicvFVuTAQLBryyccRXMUaGHP

    &gt; <span class="nv">NEW_ADDRESS1</span><span class="o">=</span>mhAXF4Eq7iRyvbYk1mpDVBiGdLP3YbY6Dm
    &gt; <span class="nv">NEW_ADDRESS2</span><span class="o">=</span>moaCrnRfP5zzyhW8k65f6Rf2z5QpvJzSKe
    &gt; <span class="nv">NEW_ADDRESS3</span><span class="o">=</span>mk2QpYatsKicvFVuTAQLBryyccRXMUaGHP</code></pre></figure>

  <p>Generate three new P2PKH addresses. P2PKH addresses cannot be used with
the multisig redeem script created below. (Hashing each public key is
unnecessary anyway—all the public keys are protected by a hash when
the redeem script is hashed.) However, Bitcoin Core uses addresses as a
way to reference the underlying full (unhashed) public keys it knows
about, so we get the three new addresses above in order to use their
public keys.</p>

  <p>Recall from the Guide that the hashed public keys used in addresses
obfuscate the full public key, so you cannot give an address to another
person or device as part of creating a typical multisig output or P2SH multisig
redeem script. You must give them a full public key.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest validateaddress <span class="nv">$NEW_ADDRESS3</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"isvalid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mk2QpYatsKicvFVuTAQLBryyccRXMUaGHP"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"76a9143172b5654f6683c8fb146959d347ce303cae4ca788ac"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ismine"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"iswatchonly"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"isscript"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"pubkey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"029e03a901b85534ff1e92c43c74431f7ce72046060fcf7a\
                95c37e148f78c77255"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"iscompressed"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"account"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS3_PUBLIC_KEY</span><span class="o">=</span>029e03a901b85534ff1e92c43c74431f7ce720[...]</code></pre></figure>

  </div>

  <p>Use the <code class="highlighter-rouge">validateaddress</code> RPC to display the full (unhashed) public key
for one of the addresses.  This is the information which will 
actually be included in the multisig redeem script.  This is also the
information you would give another person or device as part of creating
a multisig output or P2SH multisig redeem script.</p>

  <p>We save the address returned to a shell variable.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest createmultisig 2 <span class="s1">'''
    [
      "'</span><span class="nv">$NEW_ADDRESS1</span><span class="s1">'",
      "'</span><span class="nv">$NEW_ADDRESS2</span><span class="s1">'", 
      "'</span><span class="nv">$NEW_ADDRESS3_PUBLIC_KEY</span><span class="s1">'"
    ]'''</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"address"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2N7NaqSKYQUeM8VNgBy8D9xQQbiA8yiJayk"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"redeemScript"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"522103310188e911026cf18c3ce274e0ebb5f95b00\
    7f230d8cb7d09879d96dbeab1aff210243930746e6ed6552e03359db521b\
    088134652905bd2d1541fa9124303a41e95621029e03a901b85534ff1e92\
    c43c74431f7ce72046060fcf7a95c37e148f78c7725553ae"</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">P2SH_ADDRESS</span><span class="o">=</span>2N7NaqSKYQUeM8VNgBy8D9xQQbiA8yiJayk
<span class="gp">&gt; </span><span class="nv">P2SH_REDEEM_SCRIPT</span><span class="o">=</span>522103310188e911026cf18c3ce274e0ebb5f95b007[...]</code></pre></figure>

  </div>

  <p>Use the <code class="highlighter-rouge">createmultisig</code> RPC with two arguments, the number (<em>n</em>) of
signatures required and a list of addresses or public keys.  Because
P2PKH addresses can’t be used in the multisig redeem script created by this
RPC, the only addresses which can be provided are those belonging to a
public key in the wallet.  In this case, we provide two addresses and
one public key—all of which will be converted to public keys in the
redeem script.</p>

  <p>The P2SH address is returned along with the redeem script which must be
provided when we spend satoshis sent to the P2SH address.</p>

  <p><img src="/img/icons/icon_warning.svg" alt="Warning icon" />
 <strong>Warning:</strong> You must not lose the redeem script, especially if you
don’t have a record of which public keys you used to create the P2SH
multisig address. You need the redeem script to spend any bitcoins sent
to the P2SH address. If you lose the redeem script, you can recreate it
by running the same command above, with the public keys listed in the
same order. However, if you lose both the redeem script and even one of
the public keys, you will never be able to spend satoshis sent to that
P2SH address.</p>

  <p>Neither the address nor the redeem script are stored in the wallet when
you use <code class="highlighter-rouge">createmultisig</code>. To store them in the wallet, use the
<code class="highlighter-rouge">addmultisigaddress</code> RPC instead.  If you add an address to the wallet,
you should also make a new backup.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest sendtoaddress <span class="nv">$P2SH_ADDRESS</span> 10.00
7278d7d030f042ebe633732b512bcb31fff14a697675a1fe1884db139876e175

<span class="gp">&gt; </span><span class="nv">UTXO_TXID</span><span class="o">=</span>7278d7d030f042ebe633732b512bcb31fff14a697675a1fe1884[...]</code></pre></figure>

  <p>Paying the P2SH multisig address with Bitcoin Core is as simple as
paying a more common P2PKH address. Here we use the same command (but
different variable) we used in the Simple Spending subsection. As
before, this command automatically selects an UTXO, creates a change
output to a new one of our P2PKH addresses if necessary, and pays a
transaction fee if necessary.</p>

  <p>We save that txid to a shell variable as the txid of the UTXO we plan to spend next.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest getrawtransaction <span class="nv">$UTXO_TXID</span> 1</code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"0100000001f0ede03d75050f20801d50358829ae02c058e8677\
             d2cc74df51f738285013c26010000006a47304402203c375959\
             2bf608ab79c01596c4a417f3110dd6eb776270337e575cdafc6\
             99af20220317ef140d596cc255a4067df8125db7f349ad94521\
             2e9264a87fa8d777151937012102a92913b70f9fb15a7ea5c42\
             df44637f0de26e2dad97d6d54957690b94cf2cd05ffffffff01\
             00ca9a3b0000000017a9149af61346ce0aa2dffcf697352b4b7\
             04c84dcbaff8700000000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"7278d7d030f042ebe633732b512bcb31fff14a697675a1fe18\
              84db139876e175"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hash"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"7278d7d030f042ebe633732b512bcb31fff14a697675a1fe1884db139876e175"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"size"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">189</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vsize"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">189</span><span class="p">,</span><span class="w">
    </span><span class="nt">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"locktime"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vin"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"txid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"263c018582731ff54dc72c7d67e858c002ae298835\
                      501d80200f05753de0edf0"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nt">"scriptSig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"asm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"304402203c3759592bf608ab79c01596c4a417f\
                         3110dd6eb776270337e575cdafc699af2022031\
                         7ef140d596cc255a4067df8125db7f349ad9452\
                         12e9264a87fa8d77715193701
                         02a92913b70f9fb15a7ea5c42df44637f0de26e\
                         2dad97d6d54957690b94cf2cd05"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"47304402203c3759592bf608ab79c01596c4a41\
                         7f3110dd6eb776270337e575cdafc699af20220\
                         317ef140d596cc255a4067df8125db7f349ad94\
                         5212e9264a87fa8d777151937012102a92913b7\
                         0f9fb15a7ea5c42df44637f0de26e2dad97d6d5\
                         4957690b94cf2cd05"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"sequence"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4294967295</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"vout"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"value"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">10.00000000</span><span class="p">,</span><span class="w">
            </span><span class="nt">"n"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"scriptPubKey"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"asm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"OP_HASH160 9af61346ce0aa2dffcf697352b4b\
                704c84dcbaff OP_EQUAL"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"a9149af61346ce0aa2dffcf697352b4b704c84d\
                         cbaff87"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"reqSigs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"scripthash"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"addresses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"2N7NaqSKYQUeM8VNgBy8D9xQQbiA8yiJayk"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">UTXO_VOUT</span><span class="o">=</span>0
<span class="gp">&gt; </span><span class="nv">UTXO_OUTPUT_SCRIPT</span><span class="o">=</span>a9149af61346ce0aa2dffcf697352b4b704c84dcbaff87</code></pre></figure>

  </div>

  <p>We use the <code class="highlighter-rouge">getrawtransaction</code> RPC with the optional second argument
(<em>true</em>) to get the decoded transaction we just created with
<code class="highlighter-rouge">spendtoaddress</code>. We choose one of the outputs to be our UTXO and get
its output index number (vout) and pubkey script (scriptPubKey).</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest getnewaddress
mxCNLtKxzgjg8yyNHeuFSXvxCvagkWdfGU

<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS4</span><span class="o">=</span>mxCNLtKxzgjg8yyNHeuFSXvxCvagkWdfGU</code></pre></figure>

  <p>We generate a new P2PKH address to use in the output we’re about to
create.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">## Outputs - inputs = transaction fee, so always double-check your math!</span>
<span class="gp">&gt; </span>bitcoin-cli -regtest createrawtransaction <span class="s1">'''
    [
      {
        "txid": "'</span><span class="nv">$UTXO_TXID</span><span class="s1">'",
        "vout": '</span><span class="nv">$UTXO_VOUT</span><span class="s1">'
      }
   ]
   '''</span> <span class="s1">'''
   {
     "'</span><span class="nv">$NEW_ADDRESS4</span><span class="s1">'": 9.998
   }'''</span>

010000000175e1769813db8418fea17576694af1ff31cb2b512b7333e6eb42f0<span class="se">\</span>
30d0d778720000000000ffffffff01c0bc973b000000001976a914b6f64f5bf3<span class="se">\</span>
e38f25ead28817df7929c06fe847ee88ac00000000

<span class="gp">&gt; </span><span class="nv">RAW_TX</span><span class="o">=</span>010000000175e1769813db8418fea17576694af1ff31cb2b512b733[...]</code></pre></figure>

  <p>We generate the raw transaction the same way we did in the Simple Raw
Transaction subsection.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest dumpprivkey <span class="nv">$NEW_ADDRESS1</span>
cVinshabsALz5Wg4tGDiBuqEGq4i6WCKWXRQdM8RFxLbALvNSHw7
<span class="gp">&gt; </span>bitcoin-cli -regtest dumpprivkey <span class="nv">$NEW_ADDRESS3</span>
cNmbnwwGzEghMMe1vBwH34DFHShEj5bcXD1QpFRPHgG9Mj1xc5hq

<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS1_PRIVATE_KEY</span><span class="o">=</span>cVinshabsALz5Wg4tGDiBuqEGq4i6WCKWXRQd[...]
<span class="gp">&gt; </span><span class="nv">NEW_ADDRESS3_PRIVATE_KEY</span><span class="o">=</span>cNmbnwwGzEghMMe1vBwH34DFHShEj5bcXD1Qp[...]</code></pre></figure>

  <p>We get the private keys for two of the public keys we used to create the
transaction, the same way we got private keys in the Complex Raw
Transaction subsection. Recall that we created a 2-of-3 multisig pubkey script,
so signatures from two private keys are needed.</p>

  <p><img src="/img/icons/icon_warning.svg" alt="Warning icon" />
 <strong>Reminder:</strong> Users should never manually manage private keys on
mainnet. See the warning in the <a href="/en/developer-examples#complex-raw-transaction">complex raw transaction section</a>.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest signrawtransaction <span class="nv">$RAW_TX</span> <span class="s1">'''
    [
      {
        "txid": "'</span><span class="nv">$UTXO_TXID</span><span class="s1">'", 
        "vout": '</span><span class="nv">$UTXO_VOUT</span><span class="s1">', 
        "scriptPubKey": "'</span><span class="nv">$UTXO_OUTPUT_SCRIPT</span><span class="s1">'", 
        "redeemScript": "'</span><span class="nv">$P2SH_REDEEM_SCRIPT</span><span class="s1">'"
      }
    ]
    '''</span> <span class="s1">'''
    [
      "'</span><span class="nv">$NEW_ADDRESS1_PRIVATE_KEY</span><span class="s1">'"
    ]'''</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"010000000175e1769813db8418fea17576694af1ff31cb2b512\
             b7333e6eb42f030d0d7787200000000b5004830450221008d5e\
             c57d362ff6ef6602e4e756ef1bdeee12bd5c5c72697ef1455b3\
             79c90531002202ef3ea04dfbeda043395e5bc701e4878c15baa\
             b9c6ba5808eb3d04c91f641a0c014c69522103310188e911026\
             cf18c3ce274e0ebb5f95b007f230d8cb7d09879d96dbeab1aff\
             210243930746e6ed6552e03359db521b088134652905bd2d154\
             1fa9124303a41e95621029e03a901b85534ff1e92c43c74431f\
             7ce72046060fcf7a95c37e148f78c7725553aeffffffff01c0b\
             c973b000000001976a914b6f64f5bf3e38f25ead28817df7929\
             c06fe847ee88ac00000000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"complete"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">PARTLY_SIGNED_RAW_TX</span><span class="o">=</span>010000000175e1769813db8418fea17576694af1f[...]</code></pre></figure>

  </div>

  <p>We make the first signature. The input argument (JSON object) takes the
additional redeem script parameter so that it can append the redeem script
to the signature script after the two signatures.</p>

  <div class="multicode">

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest signrawtransaction <span class="nv">$PARTLY_SIGNED_RAW_TX</span> <span class="s1">'''
    [
      {
        "txid": "'</span><span class="nv">$UTXO_TXID</span><span class="s1">'",
        "vout": '</span><span class="nv">$UTXO_VOUT</span><span class="s1">',
        "scriptPubKey": "'</span><span class="nv">$UTXO_OUTPUT_SCRIPT</span><span class="s1">'", 
        "redeemScript": "'</span><span class="nv">$P2SH_REDEEM_SCRIPT</span><span class="s1">'"
      }
    ]
    '''</span> <span class="s1">'''
    [
      "'</span><span class="nv">$NEW_ADDRESS3_PRIVATE_KEY</span><span class="s1">'"
    ]'''</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"hex"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"010000000175e1769813db8418fea17576694af1ff31cb2b512\
             b7333e6eb42f030d0d7787200000000fdfd0000483045022100\
             8d5ec57d362ff6ef6602e4e756ef1bdeee12bd5c5c72697ef14\
             55b379c90531002202ef3ea04dfbeda043395e5bc701e4878c1\
             5baab9c6ba5808eb3d04c91f641a0c0147304402200bd8c62b9\
             38e02094021e481b149fd5e366a212cb823187149799a68cfa7\
             652002203b52120c5cf25ceab5f0a6b5cdb8eca0fd2f386316c\
             9721177b75ddca82a4ae8014c69522103310188e911026cf18c\
             3ce274e0ebb5f95b007f230d8cb7d09879d96dbeab1aff21024\
             3930746e6ed6552e03359db521b088134652905bd2d1541fa91\
             24303a41e95621029e03a901b85534ff1e92c43c74431f7ce72\
             046060fcf7a95c37e148f78c7725553aeffffffff01c0bc973b\
             000000001976a914b6f64f5bf3e38f25ead28817df7929c06fe\
             847ee88ac00000000"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"complete"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="gp">&gt; </span><span class="nv">SIGNED_RAW_TX</span><span class="o">=</span>010000000175e1769813db8418fea17576694af1ff31cb2b[...]</code></pre></figure>

  </div>

  <p>The <code class="highlighter-rouge">signrawtransaction</code> call used here is nearly identical to the one
used above.  The only difference is the private key used.  Now that the
two required signatures have been provided, the transaction is marked as
complete.</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">&gt; </span>bitcoin-cli -regtest sendrawtransaction <span class="nv">$SIGNED_RAW_TX</span>
430a4cee3a55efb04cbb8718713cab18dea7f2521039aa660ffb5aae14ff3f50</code></pre></figure>

  <p>We send the transaction spending the P2SH multisig output to the local
node, which accepts it.</p>

  <h2 id="payment-processing">Payment Processing</h2>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_payment_processing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_payment_processing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_payment_processing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_payment_processing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <h3 id="payment-protocol">Payment Protocol</h3>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_payment_processing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_payment_processing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_payment_processing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_payment_processing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>To request payment using the payment protocol, you use an extended (but
backwards-compatible) <code class="highlighter-rouge">bitcoin:</code> URI.  For example:</p>

  <div class="highlighter-rouge"><pre><code>bitcoin:mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN\
?amount=0.10\
&amp;label=Example+Merchant\
&amp;message=Order+of+flowers+%26+chocolates\
&amp;r=https://example.com/pay.php/invoice%3Dda39a3ee
</code></pre>
  </div>

  <p>The browser, QR code reader, or other program processing the URI opens
the spender’s Bitcoin wallet program on the URI. If the wallet program is
aware of the payment protocol, it accesses the URL specified in the <code class="highlighter-rouge">r</code>
parameter, which should provide it with a serialized PaymentRequest
served with the <a href="https://en.wikipedia.org/wiki/Internet_media_type">MIME</a> type <code class="highlighter-rouge">application/bitcoin-paymentrequest</code><!--noref-->.</p>

  <p><strong>Resource:</strong> Gavin Andresen’s <a href="https://github.com/gavinandresen/paymentrequest/blob/master/php/demo_website/createpaymentrequest.php">Payment Request Generator</a> generates
custom example URIs and payment requests for use with testnet.</p>

  <h4 id="paymentrequest--paymentdetails">PaymentRequest &amp; PaymentDetails</h4>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_payment_processing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_payment_processing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_payment_processing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_payment_processing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>The <a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" id="term-paymentrequest" class="term">PaymentRequest</a> is created with data structures built using
Google’s Protocol Buffers. BIP70 describes these data
structures in the non-sequential way they’re defined in the payment
request protocol buffer code, but the text below will describe them in
a more linear order using a simple (but functional) Python CGI
program. (For brevity and clarity, many normal CGI best practices are
not used in this program.)</p>

  <p>The full sequence of events is illustrated below, starting with the
spender clicking a <code class="highlighter-rouge">bitcoin:</code> URI or scanning a <code class="highlighter-rouge">bitcoin:</code> QR code.</p>

  <p><img src="/img/dev/en-payment-protocol.svg" alt="BIP70 Payment Protocol" /></p>

  <p>For the script to use the protocol buffer, you will need a copy of
Google’s Protocol Buffer compiler (<code class="highlighter-rouge">protoc</code>), which is available in most
modern Linux package managers and <a href="https://developers.google.com/protocol-buffers/">directly from Google.</a> Non-Google
protocol buffer compilers are available for a variety of
programming languages. You will also need a copy of the PaymentRequest
<a href="https://github.com/dashpay/dash/blob/master/src/qt/paymentrequest.proto">Protocol Buffer description</a> from the Bitcoin Core source code.</p>

  <h5 id="initialization-code">Initialization Code</h5>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_payment_processing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_payment_processing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_payment_processing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_payment_processing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>With the Python code generated by <code class="highlighter-rouge">protoc</code>, we can start our simple
CGI program.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>

<span class="c">## This is the code generated by protoc --python_out=./ paymentrequest.proto</span>
<span class="kn">from</span> <span class="nn">paymentrequest_pb2</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c">## Load some functions</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">stdout</span>
<span class="kn">from</span> <span class="nn">OpenSSL.crypto</span> <span class="kn">import</span> <span class="n">FILETYPE_PEM</span><span class="p">,</span> <span class="n">load_privatekey</span><span class="p">,</span> <span class="n">sign</span>

<span class="c">## Copy three of the classes created by protoc into objects we can use</span>
<span class="n">details</span> <span class="o">=</span> <span class="n">PaymentDetails</span><span class="p">()</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">PaymentRequest</span><span class="p">()</span>
<span class="n">x509</span> <span class="o">=</span> <span class="n">X509Certificates</span><span class="p">()</span></code></pre></figure>

  <p>The startup code above is quite simple, requiring nothing but the epoch
(Unix date) time function, the standard out file descriptor, a few
functions from the OpenSSL library, and the data structures and
functions created by <code class="highlighter-rouge">protoc</code>.</p>

  <h5 id="configuration-code">Configuration Code</h5>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_payment_processing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_payment_processing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_payment_processing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_payment_processing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>Next, we’ll set configuration settings which will typically only change
when the receiver wants to do something differently. The code pushes a
few settings into the <code class="highlighter-rouge">request</code> (PaymentRequest) and <code class="highlighter-rouge">details</code>
(PaymentDetails) objects. When we serialize them,
<a href="/en/developer-examples#term-paymentdetails" title="The PaymentDetails of the payment protocol which allows the receiver to specify the payment details to the spender" id="term-paymentdetails" class="term">PaymentDetails</a> will be contained
within the PaymentRequest.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## SSL Signature method</span>
<span class="n">request</span><span class="o">.</span><span class="n">pki_type</span> <span class="o">=</span> <span class="s">"x509+sha256"</span>  <span class="c">## Default: none</span>

<span class="c">## Mainnet or testnet?</span>
<span class="n">details</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="s">"test"</span>  <span class="c">## Default: main</span>

<span class="c">## Postback URL</span>
<span class="n">details</span><span class="o">.</span><span class="n">payment_url</span> <span class="o">=</span> <span class="s">"https://example.com/pay.py"</span>

<span class="c">## PaymentDetails version number</span>
<span class="n">request</span><span class="o">.</span><span class="n">payment_details_version</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c">## Default: 1</span>

<span class="c">## Certificate chain</span>
<span class="n">x509</span><span class="o">.</span><span class="n">certificate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">file</span><span class="p">(</span><span class="s">"/etc/apache2/example.com-cert.der"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c">#x509.certificate.append(file("/some/intermediate/cert.der", "r").read())</span>

<span class="c">## Load private SSL key into memory for signing later</span>
<span class="n">priv_key</span> <span class="o">=</span> <span class="s">"/etc/apache2/example.com-key.pem"</span>
<span class="n">pw</span> <span class="o">=</span> <span class="s">"test"</span>  <span class="c">## Key password</span>
<span class="n">private_key</span> <span class="o">=</span> <span class="n">load_privatekey</span><span class="p">(</span><span class="n">FILETYPE_PEM</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span><span class="n">priv_key</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">pw</span><span class="p">)</span></code></pre></figure>

  <p>Each line is described below.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">request</span><span class="o">.</span><span class="n">pki_type</span> <span class="o">=</span> <span class="s">"x509+sha256"</span>  <span class="c">## Default: none</span></code></pre></figure>

  <p><code class="highlighter-rouge">pki_type</code>: (optional) tell the receiving wallet program what <a href="/en/developer-examples#term-pki" title="Public Key Infrastructure; usually meant to indicate the X.509 certificate system used for HTTP Secure (https)." id="term-pki" class="term">Public-Key
Infrastructure</a> (PKI) type you’re using to
cryptographically sign your PaymentRequest so that it can’t be modified
by a man-in-the-middle attack.</p>

  <p>If you don’t want to sign the PaymentRequest, you can choose a
<a href="/en/developer-examples#term-pp-pki-type" title="The PKI field of a PaymentRequest which tells spenders how to validate this request as being from a specific recipient" id="term-pp-pki-type" class="term"><code class="highlighter-rouge">pki_type</code></a> of <code class="highlighter-rouge">none</code>
(the default).</p>

  <p>If you do choose the sign the PaymentRequest, you currently have two
options defined by BIP70: <code class="highlighter-rouge">x509+sha1</code> and <code class="highlighter-rouge">x509+sha256</code>.  Both options
use the X.509 certificate system, the same system used for HTTP Secure
(HTTPS).  To use either option, you will need a certificate signed by a
certificate authority or one of their intermediaries. (A self-signed
certificate will not work.)</p>

  <p>Each wallet program may choose which certificate authorities to trust,
but it’s likely that they’ll trust whatever certificate authorities their
operating system trusts.  If the wallet program doesn’t have a full
operating system, as might be the case for small hardware wallets, BIP70
suggests they use the <a href="https://www.mozilla.org/en-US/about/governance/policies/security-group/certs/">Mozilla Root Certificate Store</a>. In
general, if a certificate works in your web browser when you connect to
your webserver, it will work for your PaymentRequests.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">details</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="s">"test"</span>  <span class="c">## Default: main</span></code></pre></figure>

  <p><code class="highlighter-rouge">network</code>:<!--noref--> (optional) tell the spender’s wallet program what Bitcoin network you’re
using; BIP70 defines “main” for mainnet (actual payments) and “test” for
testnet (like mainnet, but fake satoshis are used). If the wallet
program doesn’t run on the network you indicate, it will reject the
PaymentRequest.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">details</span><span class="o">.</span><span class="n">payment_url</span> <span class="o">=</span> <span class="s">"https://example.com/pay.py"</span></code></pre></figure>

  <p><code class="highlighter-rouge">payment_url</code>: (required) tell the spender’s wallet program where to send the Payment
message (described later). This can be a static URL, as in this example,
or a variable URL such as <code class="highlighter-rouge">https://example.com/pay.py?invoice=123.</code>
It should usually be an HTTPS address to prevent man-in-the-middle
attacks from modifying the message.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">request</span><span class="o">.</span><span class="n">payment_details_version</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c">## Default: 1</span></code></pre></figure>

  <p><code class="highlighter-rouge">payment_details_version</code>: (optional) tell the spender’s wallet program what version of the
PaymentDetails you’re using. As of this writing, the only version is
version 1.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## This is the pubkey/certificate corresponding to the private SSL key</span>
<span class="c">## that we'll use to sign:</span>
<span class="n">x509</span><span class="o">.</span><span class="n">certificate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">file</span><span class="p">(</span><span class="s">"/etc/apache2/example.com-cert.der"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></code></pre></figure>

  <p><code class="highlighter-rouge">x509certificates</code>:<!--noref--> (required for signed PaymentRequests) you must
provide the public SSL key/certificate corresponding to the private SSL
key you’ll use to sign the PaymentRequest. The certificate must be in
ASN.1/DER format.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## If the pubkey/cert above didn't have the signature of a root</span>
<span class="c">## certificate authority, we'd then append the intermediate certificate</span>
<span class="c">## which signed it:</span>
<span class="c">#x509.certificate.append(file("/some/intermediate/cert.der", "r").read())</span></code></pre></figure>

  <p>You must also provide any intermediate certificates necessary to link
your certificate to the root certificate of a certificate authority
trusted by the spender’s software, such as a certificate from the
Mozilla root store.</p>

  <p>The certificates must be provided in a specific order—the same order
used by Apache’s <code class="highlighter-rouge">SSLCertificateFile</code> directive and other server
software.   The figure below shows the <a href="/en/developer-examples#term-certificate-chain" title="A chain of certificates connecting a individual's leaf certificate to the certificate authority's root certificate" id="term-certificate-chain" class="term">certificate chain</a> of the
www.bitcoin.org X.509 certificate and how each certificate (except the
root certificate) would be loaded into the <a href="/en/developer-examples#term-x509certificates" id="term-x509certificates" class="term">X509Certificates</a> protocol
buffer message.</p>

  <p><img src="/img/dev/en-cert-order.svg" alt="X509Certificates Loading Order" /></p>

  <p>To be specific, the first certificate provided must be the
X.509 certificate corresponding to the private SSL key which will make the
signature<!--noref-->, called the <a href="/en/developer-examples#term-leaf-certificate" title="The end-node in a certificate chain; in the payment protocol, it is the certificate belonging to the receiver of satoshis" id="term-leaf-certificate" class="term">leaf certificate</a>. Any <a href="/en/developer-examples#term-intermediate-certificate" title="A intermediate certificate authority certificate which helps connect a leaf (receiver) certificate to a root certificate authority" id="term-intermediate-certificate" class="term">intermediate
certificates</a> necessary to link that signed public SSL
key to the <a href="/en/developer-examples#term-root-certificate" title="A certificate belonging to a certificate authority (CA)" id="term-root-certificate" class="term">root
certificate</a> (the certificate authority) are attached separately, with each
certificate in DER format bearing the signature<!--noref--> of the certificate that
follows it all the way to (but not including) the root certificate.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">priv_key</span> <span class="o">=</span> <span class="s">"/etc/apache2/example.com-key.pem"</span>
<span class="n">pw</span> <span class="o">=</span> <span class="s">"test"</span>  <span class="c">## Key password</span>
<span class="n">private_key</span> <span class="o">=</span> <span class="n">load_privatekey</span><span class="p">(</span><span class="n">FILETYPE_PEM</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span><span class="n">priv_key</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">pw</span><span class="p">)</span></code></pre></figure>

  <p>(Required for signed PaymentRequests) you will need a private SSL key in
a format your SSL library supports (DER format is not required). In this
program, we’ll load it from a PEM file. (Embedding your passphrase in
your CGI code, as done here, is obviously a bad idea in real life.)</p>

  <p>The private SSL key will not be transmitted with your request. We’re
only loading it into memory here so we can use it to sign the request
later.</p>

  <h5 id="code-variables">Code Variables</h5>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_payment_processing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_payment_processing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_payment_processing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_payment_processing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>Now let’s look at the variables your CGI program will likely set for
each payment.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## Amount of the request</span>
<span class="n">amount</span> <span class="o">=</span> <span class="mi">10000000</span>  <span class="c">## In satoshis</span>

<span class="c">## P2PKH pubkey hash</span>
<span class="n">pubkey_hash</span> <span class="o">=</span> <span class="s">"2b14950b8d31620c6cc923c5408a701b1ec0a020"</span>
<span class="c">## P2PKH pubkey script entered as hex and converted to binary</span>
<span class="c"># OP_DUP OP_HASH160 &lt;push 20 bytes&gt; &lt;pubKey hash&gt; OP_EQUALVERIFY OP_CHECKSIG</span>
<span class="c">#   76       a9            14       &lt;pubKey hash&gt;        88          ac</span>
<span class="n">hex_script</span> <span class="o">=</span> <span class="s">"76"</span> <span class="o">+</span> <span class="s">"a9"</span> <span class="o">+</span> <span class="s">"14"</span> <span class="o">+</span> <span class="n">pubkey_hash</span> <span class="o">+</span> <span class="s">"88"</span> <span class="o">+</span> <span class="s">"ac"</span>
<span class="n">serialized_script</span> <span class="o">=</span> <span class="n">hex_script</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>

<span class="c">## Load amount and pubkey script into PaymentDetails</span>
<span class="n">details</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="p">,</span> <span class="n">script</span> <span class="o">=</span> <span class="n">serialized_script</span><span class="p">)</span>

<span class="c">## Memo to display to the spender</span>
<span class="n">details</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="s">"Flowers &amp; chocolates"</span>

<span class="c">## Data which should be returned to you with the payment</span>
<span class="n">details</span><span class="o">.</span><span class="n">merchant_data</span> <span class="o">=</span> <span class="s">"Invoice #123"</span></code></pre></figure>

  <p>Each line is described below.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">amount</span> <span class="o">=</span> <span class="mi">10000000</span>  <span class="c">## In satoshis (=100 mBTC)</span></code></pre></figure>

  <p><code class="highlighter-rouge">amount</code>: (optional) the <a href="/en/developer-examples#term-pp-amount" title="Part of the Output part of the PaymentDetails part of a payment protocol where receivers can specify the amount of satoshis they want paid to a particular pubkey script" id="term-pp-amount" class="term">amount</a> you want the spender to pay. You’ll probably get
  this value from your shopping cart application or fiat-to-BTC exchange
  rate conversion tool. If you leave the amount blank, the wallet
  program will prompt the spender how much to pay (which can be useful
  for donations).</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">pubkey_hash</span> <span class="o">=</span> <span class="s">"2b14950b8d31620c6cc923c5408a701b1ec0a020"</span>
<span class="c"># OP_DUP OP_HASH160 &lt;push 20 bytes&gt; &lt;pubKey hash&gt; OP_EQUALVERIFY OP_CHECKSIG</span>
<span class="c">#   76       a9            14       &lt;pubKey hash&gt;        88          ac</span>
<span class="n">hex_script</span> <span class="o">=</span> <span class="s">"76"</span> <span class="o">+</span> <span class="s">"a9"</span> <span class="o">+</span> <span class="s">"14"</span> <span class="o">+</span> <span class="n">pubkey_hash</span> <span class="o">+</span> <span class="s">"88"</span> <span class="o">+</span> <span class="s">"ac"</span>
<span class="n">serialized_script</span> <span class="o">=</span> <span class="n">hex_script</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span></code></pre></figure>

  <p><code class="highlighter-rouge">script</code>: (required) You must specify the pubkey script you want the spender to
pay—any valid pubkey script is acceptable. In this example, we’ll request
payment to a P2PKH pubkey script.</p>

  <p>First we get a pubkey hash. The hash above is the hash form of the
address used in the URI examples throughout this section,
mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN.</p>

  <p>Next, we plug that hash into the standard P2PKH pubkey script using hex,
as illustrated by the code comments.</p>

  <p>Finally, we convert the pubkey script from hex into its serialized form.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">details</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="p">,</span> <span class="n">script</span> <span class="o">=</span> <span class="n">serialized_script</span><span class="p">)</span></code></pre></figure>

  <p><code class="highlighter-rouge">outputs</code>:<!--noref--> (required) add the pubkey script and (optional) amount to the
PaymentDetails outputs<!--noref--> array.</p>

  <p>It’s possible to specify multiple <a href="/en/developer-examples#term-pp-script" title="The script field of a PaymentDetails where the receiver tells the spender what pubkey scripts to pay" id="term-pp-script" class="term"><code class="highlighter-rouge">scripts</code></a> and <code class="highlighter-rouge">amounts</code> as part of a merge
avoidance strategy, described later in the <a href="/en/developer-guide#merge-avoidance">Merge Avoidance
subsection</a>. However, effective merge avoidance is not possible under
the base BIP70 rules in which the spender pays each <code class="highlighter-rouge">script</code> the exact
amount specified by its paired <code class="highlighter-rouge">amount</code>. If the amounts are omitted from
all <code class="highlighter-rouge">amount</code>/<code class="highlighter-rouge">script</code> pairs, the spender will be prompted to choose an
amount to pay.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">details</span><span class="o">.</span><span class="n">memo</span> <span class="o">=</span> <span class="s">"Flowers &amp; chocolates"</span></code></pre></figure>

  <p><code class="highlighter-rouge">memo</code>: (optional) add a memo which will be displayed to the spender as
plain UTF-8 text. Embedded HTML or other markup will not be processed.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">details</span><span class="o">.</span><span class="n">merchant_data</span> <span class="o">=</span> <span class="s">"Invoice #123"</span></code></pre></figure>

  <p><code class="highlighter-rouge">merchant_data</code>: (optional) add arbitrary data which should be sent back to the
receiver when the invoice is paid. You can use this to track your
invoices, although you can more reliably track payments by generating a
unique address for each payment and then tracking when it gets paid.</p>

  <p>The <a href="/en/developer-examples#term-pp-memo" title="The memo fields of PaymentDetails, Payment, and PaymentACK which allow spenders and receivers to send each other memos" id="term-pp-memo" class="term"><code class="highlighter-rouge">memo</code></a> field and the <a href="/en/developer-examples#term-pp-merchant-data" title="The merchant_data part of PaymentDetails and Payment which allows the receiver to send arbitrary data to the spender in PaymentDetails and receive it back in Payments" id="term-pp-merchant-data" class="term"><code class="highlighter-rouge">merchant_data</code></a> field can be arbitrarily long,
but if you make them too long, you’ll run into the 50,000 byte limit on
the entire PaymentRequest, which includes the often several kilobytes
given over to storing the certificate chain. As will be described in a
later subsection, the <code class="highlighter-rouge">memo</code> field can be used by the spender after
payment as part of a cryptographically-proven receipt.</p>

  <h5 id="derivable-data">Derivable Data</h5>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_payment_processing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_payment_processing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_payment_processing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_payment_processing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>Next, let’s look at some information your CGI program can
automatically derive.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## Request creation time</span>
<span class="n">details</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">())</span> <span class="c">## Current epoch (Unix) time</span>

<span class="c">## Request expiration time</span>
<span class="n">details</span><span class="o">.</span><span class="n">expires</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c">## 10 minutes from now</span>

<span class="c">## PaymentDetails is complete; serialize it and store it in PaymentRequest</span>
<span class="n">request</span><span class="o">.</span><span class="n">serialized_payment_details</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>

<span class="c">## Serialized certificate chain</span>
<span class="n">request</span><span class="o">.</span><span class="n">pki_data</span> <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>

<span class="c">## Initialize signature field so we can sign the full PaymentRequest</span>
<span class="n">request</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="s">""</span>

<span class="c">## Sign PaymentRequest</span>
<span class="n">request</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">(),</span> <span class="s">"sha256"</span><span class="p">)</span></code></pre></figure>

  <p>Each line is described below.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">details</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">())</span> <span class="c">## Current epoch (Unix) time</span></code></pre></figure>

  <p><code class="highlighter-rouge">time</code>: (required) PaymentRequests must indicate when they were created
in number of seconds elapsed since 1970-01-01T00:00 UTC (Unix
epoch time format).</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">details</span><span class="o">.</span><span class="n">expires</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c">## 10 minutes from now</span></code></pre></figure>

  <p><code class="highlighter-rouge">expires</code>: (optional) the PaymentRequest may also set an <a href="/en/developer-examples#term-pp-expires" title="The expires field of a PaymentDetails where the receiver tells the spender when the PaymentDetails expires" id="term-pp-expires" class="term"><code class="highlighter-rouge">expires</code></a> time after
which they’re no longer valid. You probably want to give receivers
the ability to configure the expiration time delta; here we used the
reasonable choice of 10 minutes. If this request is tied to an order
total based on a fiat-to-satoshis exchange rate, you probably want to
base this on a delta from the time you got the exchange rate.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">request</span><span class="o">.</span><span class="n">serialized_payment_details</span> <span class="o">=</span> <span class="n">details</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span></code></pre></figure>

  <p><code class="highlighter-rouge">serialized_payment_details</code>: (required) we’ve now set everything we need to create the
PaymentDetails, so we’ll use the SerializeToString function from the
protocol buffer code to store the PaymentDetails in the appropriate
field of the PaymentRequest.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">request</span><span class="o">.</span><span class="n">pki_data</span> <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span></code></pre></figure>

  <p><code class="highlighter-rouge">pki_data</code>: (required for signed PaymentRequests) serialize the certificate chain
<a href="/en/developer-examples#term-pp-pki-data" title="The pki_data field of a PaymentRequest which provides details such as certificates necessary to validate the request" id="term-pp-pki-data" class="term">PKI data</a> and store it in the
PaymentRequest</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">request</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="s">""</span></code></pre></figure>

  <p>We’ve filled out everything in the PaymentRequest except the signature,
but before we sign it, we have to initialize the signature field by
setting it to a zero-byte placeholder.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">request</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">private_key</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">(),</span> <span class="s">"sha256"</span><span class="p">)</span></code></pre></figure>

  <p><code class="highlighter-rouge">signature</code>:<!--noref--> (required for signed PaymentRequests) now we
make the <a href="/en/developer-examples#term-ssl-signature" title="Signatures created and recognized by major SSL implementations such as OpenSSL" id="term-ssl-signature" class="term">signature</a> by
signing the completed and serialized PaymentRequest. We’ll use the
private key we stored in memory in the configuration section and the
same hashing formula we specified in <code class="highlighter-rouge">pki_type</code> (sha256 in this case)</p>

  <h5 id="output-code">Output Code</h5>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_payment_processing.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_payment_processing.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_payment_processing.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_payment_processing.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>Now that we have PaymentRequest all filled out, we can serialize it and
send it along with the HTTP headers, as shown in the code below.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="s">"Content-Type: application/bitcoin-paymentrequest"</span>
<span class="k">print</span> <span class="s">"Content-Transfer-Encoding: binary"</span>
<span class="k">print</span> <span class="s">""</span></code></pre></figure>

  <p>(Required) BIP71 defines the content types for PaymentRequests,
Payments, and PaymentACKs.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span></code></pre></figure>

  <p><code class="highlighter-rouge">request</code>: (required) now, to finish, we just dump out the serialized
PaymentRequest (which contains the serialized PaymentDetails). The
serialized data is in binary, so we can’t use Python’s print()
because it would add an extraneous newline.</p>

  <p>The following screenshot shows how the authenticated PaymentDetails
created by the program above appears in the GUI from Bitcoin Core 0.9.</p>

  <p><img src="/img/dev/en-btcc-payment-request.png" alt="Bitcoin Core Showing Validated Payment Request" /></p>

  <h2 id="p2p-network">P2P Network</h2>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_p2p_networking.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_p2p_networking.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_p2p_networking.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_p2p_networking.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <h3 id="creating-a-bloom-filter">Creating A Bloom Filter</h3>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_p2p_networking.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_p2p_networking.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_p2p_networking.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_p2p_networking.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>In this section, we’ll use variable names that correspond to the field
names in the <a href="/en/developer-reference#filterclear" title="A P2P protocol message used to send a filter to a remote peer, requesting that they only send transactions which match the filter."><code class="highlighter-rouge">filterload</code> message documentation</a>.
Each code block precedes the paragraph describing it.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>

<span class="n">BYTES_MAX</span> <span class="o">=</span> <span class="mi">36000</span>
<span class="n">FUNCS_MAX</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">nFlags</span> <span class="o">=</span> <span class="mi">0</span></code></pre></figure>

  <p>We start by setting some maximum values defined in BIP37: the maximum
number of bytes allowed in a filter and the maximum number of hash
functions used to hash each piece of data.  We also set nFlags to zero,
indicating we don’t want the remote node to update the filter for us.
(We won’t use nFlags again in the sample program, but real programs will
need to use it.)</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.0001</span></code></pre></figure>

  <p>We define the number (n) of elements we plan to insert into the filter
and the false positive rate (p) we want to help protect our privacy. For
this example, we will set <em>n</em> to one element and <em>p</em> to a rate of
1-in-10,000 to produce a small and precise filter for illustration
purposes. In actual use, your filters will probably be much larger.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>
<span class="n">nFilterBytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="n">BYTES_MAX</span><span class="p">))</span>
<span class="n">nHashFuncs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nFilterBytes</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">FUNCS_MAX</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">bitarray</span> <span class="kn">import</span> <span class="n">bitarray</span>  <span class="c"># from pypi.python.org/pypi/bitarray</span>
<span class="n">vData</span> <span class="o">=</span> <span class="n">nFilterBytes</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">bitarray</span><span class="p">(</span><span class="s">'0'</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="s">"little"</span><span class="p">)</span></code></pre></figure>

  <p>Using the formula described in BIP37, we calculate the ideal size of the
filter (in bytes) and the ideal number of hash functions to use. Both
are truncated down to the nearest whole number and both are also
constrained to the maximum values we defined earlier. The results of
this particular fixed computation are 2 filter bytes and 11 hash
functions. We then use <em>nFilterBytes</em> to create a little-endian bit
array of the appropriate size.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">nTweak</span> <span class="o">=</span> <span class="mi">0</span></code></pre></figure>

  <p>We also should choose a value for <em>nTweak</em>.  In this case, we’ll simply
use zero.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pyhash</span>  <span class="c"># from https://github.com/flier/pyfasthash</span>
<span class="n">murmur3</span> <span class="o">=</span> <span class="n">pyhash</span><span class="o">.</span><span class="n">murmur3_32</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">bloom_hash</span><span class="p">(</span><span class="n">nHashNum</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">nHashNum</span> <span class="o">*</span> <span class="mh">0xfba4c795</span> <span class="o">+</span> <span class="n">nTweak</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">murmur3</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">nFilterBytes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="p">)</span></code></pre></figure>

  <p>We setup our hash function template using the formula and 0xfba4c795
constant set in BIP37. Note that we limit the size of the seed to four
bytes and that we’re returning the result of the hash modulo the size of
the filter in bits.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data_to_hash</span> <span class="o">=</span> <span class="s">"019f5b01d4195ecbc9398fbf3c3b1fa9"</span> \
               <span class="o">+</span> <span class="s">"bb3183301d7a1fb3bd174fcfa40a2b65"</span>
<span class="n">data_to_hash</span> <span class="o">=</span> <span class="n">data_to_hash</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span></code></pre></figure>

  <p>For the data to add to the filter, we’re adding a TXID. Note that the
TXID is in internal byte order.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="s">"                             Filter (As Bits)"</span>
<span class="k">print</span> <span class="s">"nHashNum   nIndex   Filter   0123456789abcdef"</span>
<span class="k">print</span> <span class="s">"~~~~~~~~   ~~~~~~   ~~~~~~   ~~~~~~~~~~~~~~~~"</span>
<span class="k">for</span> <span class="n">nHashNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">):</span>
    <span class="n">nIndex</span> <span class="o">=</span> <span class="n">bloom_hash</span><span class="p">(</span><span class="n">nHashNum</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">)</span>

    <span class="c">## Set the bit at nIndex to 1</span>
    <span class="n">vData</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c">## Debug: print current state</span>
    <span class="k">print</span> <span class="s">'      {0:2}      {1:2}     {2}   {3}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">nHashNum</span><span class="p">,</span>
        <span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nIndex</span><span class="p">)),</span>
        <span class="n">vData</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">),</span>
        <span class="n">vData</span><span class="o">.</span><span class="n">to01</span><span class="p">()</span>
    <span class="p">)</span>

<span class="k">print</span>
<span class="k">print</span> <span class="s">"Bloom filter:"</span><span class="p">,</span> <span class="n">vData</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span></code></pre></figure>

  <p>Now we use the hash function template to run a slightly different hash
function for <em>nHashFuncs</em> times. The result of each function being run
on the transaction is used as an index number: the bit at that index is
set to 1. We can see this in the printed debugging output:</p>

  <figure class="highlight"><pre><code class="language-text" data-lang="text">                             Filter (As Bits)
nHashNum   nIndex   Filter   0123456789abcdef
~~~~~~~~   ~~~~~~   ~~~~~~   ~~~~~~~~~~~~~~~~
       0      0x7     8000   0000000100000000
       1      0x9     8002   0000000101000000
       2      0xa     8006   0000000101100000
       3      0x2     8406   0010000101100000
       4      0xb     840e   0010000101110000
       5      0x5     a40e   0010010101110000
       6      0x0     a50e   1010010101110000
       7      0x8     a50f   1010010111110000
       8      0x5     a50f   1010010111110000
       9      0x8     a50f   1010010111110000
      10      0x4     b50f   1010110111110000

Bloom filter: b50f</code></pre></figure>

  <p>Notice that in iterations 8 and 9, the filter did not change because the
corresponding bit was already set in a previous iteration (5 and 7,
respectively).  This is a normal part of bloom filter operation.</p>

  <p>We only added one element to the filter above, but we could repeat the
process with additional elements and continue to add them to the same
filter. (To maintain the same false-positive rate, you would need a
larger filter size as computed earlier.)</p>

  <p>Note: for a more optimized Python implementation with fewer external
dependencies, see <a href="https://github.com/petertodd/python-bitcoinlib">python-bitcoinlib’s</a> bloom filter
module which is based directly on Bitcoin Core’s C++ implementation.</p>

  <p>Using the <code class="highlighter-rouge">filterload</code> message format, the complete filter created above 
would be the binary form of the annotated hexdump shown below:</p>

  <figure class="highlight"><pre><code class="language-text" data-lang="text">02 ......... Filter bytes: 2
b50f ....... Filter: 1010 1101 1111 0000
0b000000 ... nHashFuncs: 11
00000000 ... nTweak: 0/none
00 ......... nFlags: BLOOM_UPDATE_NONE</code></pre></figure>

  <h3 id="evaluating-a-bloom-filter">Evaluating A Bloom Filter</h3>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_p2p_networking.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_p2p_networking.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_p2p_networking.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_p2p_networking.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>Using a bloom filter to find matching data is nearly identical to
constructing a bloom filter—except that at each step we check to see
if the calculated index bit is set in the existing filter.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">vData</span> <span class="o">=</span> <span class="n">bitarray</span><span class="p">(</span><span class="n">endian</span><span class="o">=</span><span class="s">'little'</span><span class="p">)</span>
<span class="n">vData</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="s">"b50f"</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">))</span>
<span class="n">nHashFuncs</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">nTweak</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nFlags</span> <span class="o">=</span> <span class="mi">0</span></code></pre></figure>

  <p>Using the bloom filter created above, we import its various parameters.
Note, as indicated in the section above, we won’t actually use <em>nFlags</em>
to update the filter.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">nHashNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">):</span>
        <span class="c">## bloom_hash as defined in previous section</span>
        <span class="n">nIndex</span> <span class="o">=</span> <span class="n">bloom_hash</span><span class="p">(</span><span class="n">nHashNum</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vData</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">"MATCH FAILURE: Index {0} not set in {1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nIndex</span><span class="p">)),</span>
                <span class="n">vData</span><span class="o">.</span><span class="n">to01</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span></code></pre></figure>

  <p>We define a function to check an element against the provided filter.
When checking whether the filter might contain an element, we test to
see whether a particular bit in the filter is already set to 1 (if it
isn’t, the match fails).</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## Test 1: Same TXID as previously added to filter</span>
<span class="n">data_to_hash</span> <span class="o">=</span> <span class="s">"019f5b01d4195ecbc9398fbf3c3b1fa9"</span> \
               <span class="o">+</span> <span class="s">"bb3183301d7a1fb3bd174fcfa40a2b65"</span>
<span class="n">data_to_hash</span> <span class="o">=</span> <span class="n">data_to_hash</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">contains</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">)</span></code></pre></figure>

  <p>Testing the filter against the data element we previously added, we get
no output (indicating a possible match).  Recall that bloom filters have
a zero false negative rate—so they should always match the inserted
elements.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## Test 2: Arbitrary string</span>
<span class="n">data_to_hash</span> <span class="o">=</span> <span class="s">"1/10,000 chance this ASCII string will match"</span>
<span class="n">contains</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">)</span></code></pre></figure>

  <p>Testing the filter against an arbitrary element, we get the failure
output below.  Note: we created the filter with a 1-in-10,000 false
positive rate (which was rounded up somewhat when we truncated), so it
was possible this arbitrary string would’ve matched the filter anyway.
It is not possible to set a bloom filter to a false positive rate of
zero, so your program will always have to deal with false positives.
The output below shows us that one of the hash functions returned an
index number of 0x06, but that bit wasn’t set in the filter, causing the
match failure:</p>

  <figure class="highlight"><pre><code class="language-text" data-lang="text">MATCH FAILURE: Index 0x6 not set in 1010110111110000</code></pre></figure>

  <h3 id="retrieving-a-merkleblock">Retrieving A MerkleBlock</h3>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_p2p_networking.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_p2p_networking.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_p2p_networking.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_p2p_networking.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>For the <code class="highlighter-rouge">merkleblock</code> message documentation on the reference page, an
actual merkle block was retrieved from the network and manually
processed.  This section walks through each step of the process,
demonstrating basic network communication and merkle block processing.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">network_string</span> <span class="o">=</span> <span class="s">"f9beb4d9"</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>  <span class="c"># Mainnet</span>

<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">payload</span><span class="p">):</span>
    <span class="c">## Command is ASCII text, null padded to 12 bytes</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="p">(</span> <span class="p">(</span> <span class="mi">12</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="s">"</span><span class="se">\00</span><span class="s">"</span> <span class="p">)</span>

    <span class="c">## Payload length is a uint32_t</span>
    <span class="n">payload_raw</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
    <span class="n">payload_len</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">"I"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload_raw</span><span class="p">))</span>

    <span class="c">## Checksum is first 4 bytes of SHA256(SHA256(&lt;payload&gt;))</span>
    <span class="n">checksum</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="n">sha256</span><span class="p">(</span><span class="n">payload_raw</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span><span class="o">.</span><span class="n">digest</span><span class="p">()[:</span><span class="mi">4</span><span class="p">]</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">network_string</span>
        <span class="o">+</span> <span class="n">command</span>
        <span class="o">+</span> <span class="n">payload_len</span>
        <span class="o">+</span> <span class="n">checksum</span>
        <span class="o">+</span> <span class="n">payload_raw</span>
    <span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></code></pre></figure>

  <p>To connect to the P2P network, the trivial Python function above was
developed to compute message headers and send payloads decoded from hex.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">## Create a version message</span>
<span class="n">send</span><span class="p">(</span><span class="s">"version"</span><span class="p">,</span>
      <span class="s">"71110100"</span> <span class="c"># ........................ Protocol Version: 70001</span>
    <span class="o">+</span> <span class="s">"0000000000000000"</span> <span class="c"># ................ Services: Headers Only (SPV)</span>
    <span class="o">+</span> <span class="s">"c6925e5400000000"</span> <span class="c"># ................ Time: 1415484102</span>
    <span class="o">+</span> <span class="s">"00000000000000000000000000000000"</span>
    <span class="o">+</span> <span class="s">"0000ffff7f000001208d"</span> <span class="c"># ............ Receiver IP Address/Port</span>
    <span class="o">+</span> <span class="s">"00000000000000000000000000000000"</span>
    <span class="o">+</span> <span class="s">"0000ffff7f000001208d"</span> <span class="c"># ............ Sender IP Address/Port</span>
    <span class="o">+</span> <span class="s">"0000000000000000"</span> <span class="c"># ................ Nonce (not used here)</span>
    <span class="o">+</span> <span class="s">"1b"</span> <span class="c"># .............................. Bytes in version string</span>
    <span class="o">+</span> <span class="s">"2f426974636f696e2e6f726720457861"</span>
    <span class="o">+</span> <span class="s">"6d706c653a302e392e332f"</span> <span class="c"># .......... Version string</span>
    <span class="o">+</span> <span class="s">"93050500"</span> <span class="c"># ........................ Starting block height: 329107</span>
    <span class="o">+</span> <span class="s">"00"</span> <span class="c"># .............................. Relay transactions: false</span>
<span class="p">)</span></code></pre></figure>

  <p>Peers on the network will not accept any requests until you send them a
<code class="highlighter-rouge">version</code> message. The receiving node will reply with their <code class="highlighter-rouge">version</code>
message and a <code class="highlighter-rouge">verack</code> message.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">send</span><span class="p">(</span><span class="s">"verack"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span></code></pre></figure>

  <p>We’re not going to validate their <code class="highlighter-rouge">version</code> message with this simple
script, but we will sleep a short bit and send back our own <code class="highlighter-rouge">verack</code>
message as if we had accepted their <code class="highlighter-rouge">version</code> message.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">send</span><span class="p">(</span><span class="s">"filterload"</span><span class="p">,</span> 
      <span class="s">"02"</span>  <span class="c"># ........ Filter bytes: 2</span>
    <span class="o">+</span> <span class="s">"b50f"</span> <span class="c"># ....... Filter: 1010 1101 1111 0000</span>
    <span class="o">+</span> <span class="s">"0b000000"</span> <span class="c"># ... nHashFuncs: 11</span>
    <span class="o">+</span> <span class="s">"00000000"</span> <span class="c"># ... nTweak: 0/none</span>
    <span class="o">+</span> <span class="s">"00"</span> <span class="c"># ......... nFlags: BLOOM_UPDATE_NONE</span>
<span class="p">)</span></code></pre></figure>

  <p>We set a bloom filter with the <code class="highlighter-rouge">filterload</code> message. This filter is
described in the two preceeding sections.</p>

  <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">send</span><span class="p">(</span><span class="s">"getdata"</span><span class="p">,</span>
      <span class="s">"01"</span> <span class="c"># ................................. Number of inventories: 1</span>
    <span class="o">+</span> <span class="s">"03000000"</span> <span class="c"># ........................... Inventory type: filtered block</span>
    <span class="o">+</span> <span class="s">"a4deb66c0d726b0aefb03ed51be407fb"</span>
    <span class="o">+</span> <span class="s">"ad7331c6e8f9eef231b7000000000000"</span> <span class="c"># ... Block header hash</span>
<span class="p">)</span></code></pre></figure>

  <p>We request a merkle block for transactions matching our filter,
completing our script.</p>

  <p>To run the script, we simply pipe it to the Unix <a href="https://en.wikipedia.org/wiki/Netcat"><code class="highlighter-rouge">netcat</code>
command</a> or one of its many clones, one of which is available
for practically any platform. For example, with the original netcat and
using hexdump (<code class="highlighter-rouge">hd</code>) to display the output:</p>

  <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">## Connect to the Bitcoin Core peer running on localhost</span>
python get-merkle.py | nc localhost 8333 | hd</code></pre></figure>

  <p>Part of the response is shown in the section below.</p>

  <h3 id="parsing-a-merkleblock">Parsing A MerkleBlock</h3>
  <div class="subhead-links sourcefile" data-sourcefile="_includes/devdoc/example_p2p_networking.md"><a href="https://github.com/thephez/dash.org/edit/master/_includes/devdoc/example_p2p_networking.md">Edit</a>
| <a href="https://github.com/thephez/dash.org/commits/master/_includes/devdoc/example_p2p_networking.md">History</a>
| <a href="https://github.com/thephez/dash.org/issues/new?body=Source%20File%3A%20_includes/devdoc/example_p2p_networking.md%0A%0A">Report Issue</a>
| <a href="/en/development#devcommunities">Discuss</a></div>

  <p>In the section above, we retrieved a merkle block from the network; now
we will parse it. Most of the block header has been omitted. For
a more complete hexdump, see the example in the <a href="/en/developer-reference#merkleblock" title="A P2P protocol message used to request a filtered block useful for SPV proofs"><code class="highlighter-rouge">merkleblock</code> message
section</a>.</p>

  <figure class="highlight"><pre><code class="language-text" data-lang="text">7f16c5962e8bd963659c793ce370d95f
093bc7e367117b3c30c1f8fdd0d97287 ... Merkle root

07000000 ........................... Transaction count: 7
04 ................................. Hash count: 4

3612262624047ee87660be1a707519a4
43b1c1ce3d248cbfc6c15870f6c5daa2 ... Hash #1
019f5b01d4195ecbc9398fbf3c3b1fa9
bb3183301d7a1fb3bd174fcfa40a2b65 ... Hash #2
41ed70551dd7e841883ab8f0b16bf041
76b7d1480e4f0af9f3d4c3595768d068 ... Hash #3
20d2a7bc994987302e5b1ac80fc425fe
25f8b63169ea78e68fbaaefa59379bbf ... Hash #4

01 ................................. Flag bytes: 1
1d ................................. Flags: 1 0 1 1 1 0 0 0</code></pre></figure>

  <p>We parse the above <code class="highlighter-rouge">merkleblock</code> message using the following
instructions.  Each illustration is described in the paragraph below it.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-001.svg" alt="Parsing A MerkleBlock" /></p>

  <p>We start by building the structure of a merkle tree based on the number
of transactions in the block.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-002.svg" alt="Parsing A MerkleBlock" /></p>

  <p>The first flag is a 1 and the merkle root is (as always) a non-TXID
node, so we will need to compute the hash later based on this node’s
children. Accordingly, we descend into the merkle root’s left child and
look at the next flag for instructions.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-003.svg" alt="Parsing A MerkleBlock" /></p>

  <p>The next flag in the example is a 0 and this is also a non-TXID node, so
we apply the first hash from the <code class="highlighter-rouge">merkleblock</code> message to this node. We
also don’t process any child nodes—according to the peer which created
the <code class="highlighter-rouge">merkleblock</code> message, none of those nodes will lead to TXIDs of
transactions that match our filter, so we don’t need them. We go back up
to the merkle root and then descend into its right child and look at the
next (third) flag for instructions.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-004.svg" alt="Parsing A MerkleBlock" /></p>

  <p>The third flag in the example is another 1 on another non-TXID node, so
we descend into its left child.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-005.svg" alt="Parsing A MerkleBlock" /></p>

  <p>The fourth flag is also a 1 on another non-TXID node, so we descend
again—we will always continue descending until we reach a TXID node or
a non-TXID node with a 0 flag (or we finish filling out the tree).</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-006.svg" alt="Parsing A MerkleBlock" /></p>

  <p>Finally, on the fifth flag in the example (a 1), we reach a TXID node.
The 1 flag indicates this TXID’s transaction matches our filter and
that we should take the next (second) hash and use it as this node’s
TXID.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-007.svg" alt="Parsing A MerkleBlock" /></p>

  <p>The sixth flag also applies to a TXID, but it’s a 0 flag, so this
TXID’s transaction doesn’t match our filter; still, we take the next
(third) hash and use it as this node’s TXID.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-008.svg" alt="Parsing A MerkleBlock" /></p>

  <p>We now have enough information to compute the hash for the fourth node
we encountered—it’s the hash of the concatenated hashes of the two
TXIDs we filled out.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-009.svg" alt="Parsing A MerkleBlock" /></p>

  <p>Moving to the right child of the third node we encountered, we fill it
out using the seventh flag and final hash—and discover there are no
more child nodes to process.</p>

  <p><img src="/img/dev/gifs/en-merkleblock-parsing/en-merkleblock-parsing-011.svg" alt="Parsing A MerkleBlock" /></p>

  <p>We hash as appropriate to fill out the tree.  Note that the eighth flag is
not used—this is acceptable as it was required to pad out a flag byte.</p>

  <p>The final steps would be to ensure the computed computed merkle root
is identical to the merkle root in the header and check the other steps
of the parsing checklist in the <code class="highlighter-rouge">merkleblock</code> message section.</p>

  <!-- Inventory Messages -->
  <!-- Inventory Messages: Dash Specific -->

  <!--[bitcoin-documentation mailing list]: https://groups.google.com/forum/#!forum/bitcoin-documentation-->

</div>

</div>

  <div class="footer">
    



    

<div class="footersponsor">
  <!--<div><span>A community website sponsored by</span> <a href="https://bitcoinfoundation.org/"><img src="/img/brand/bitcoinfoundation.png" alt="Bitcoin Foundation"></a></div>-->
</div>

    

<div class="footerlicense">© Bitcoin Project 2009-2017 Released under the <a href="http://opensource.org/licenses/mit-license.php" target="_blank">MIT license</a></div>

  </div>
</div>



<script type="text/javascript">
  fallbackSVG();
  addAnchorLinks();
  trackOutgoingLinks();
</script>



  <script src="/js/jquery/jquery-1.11.2.min.js"></script>
<script src="/js/jquery/jquery-ui.min.js"></script>
<script src="/js/devsearch.js"></script>
<script>updateToc();</script>



</body>

</html>
